var TTDConversionEvents;(()=>{"use strict";var e={d:(n,t)=>{for(var i in t)e.o(t,i)&&!e.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:t[i]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};e.r(n),e.d(n,{argsToSdkFunction:()=>he,clearAllConfigs:()=>Ee,event:()=>ye});var t={tcfV2ConsentVersion:2,consentRequestHasTimedOut:!1,waitForConsentTimeout:null,consentCheckExists:!1,isGdprApplicable:!1,gdprConsentString:null},i=function(){return i=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},i.apply(this,arguments)},r={merchantId:null,advertiserId:null,enableDebug:!1,enableCookieSyncing:!0,rootUrl:"https://insight.adsrvr.org",dataProcessingOption:null,pixelVersion:"3.0.0"};function o(e){return!(null==e||"string"==typeof e&&""===e.trim()||"number"==typeof e&&(isNaN(e)||!isFinite(e)))}function a(e,n,t){var i=null!=e?"adv_".concat(e):"merchant_".concat(n);return t?"".concat(i,"|").concat(t):i}function c(e,n,t,i){for(var r=0,o=(null==i?void 0:i.length)>0?i.map((function(e){return a(n,t,e)})):[a(n,t)];r<o.length;r++){var c=o[r];if(d=e.get(c))return d}var s=new Set(e.values());if(1===s.size){var d=Array.from(s)[0];return void 0===n&&void 0===t||(null==d?void 0:d.advertiserId)===n||(null==d?void 0:d.merchantId)===t?d:void 0}}function s(){return new URL(window.location.href).searchParams.has("upjs_debug")}function d(){return s()||null!=localStorage.getItem("enable-ttd-pixel-debugging")}function u(e){if(!e)return"";var n=void 0!==e.advertiserId&&null!==e.advertiserId?"adv_".concat(e.advertiserId):"merchant_".concat(e.merchantId),t=e.pixelIds&&e.pixelIds.length>0?"|".concat(e.pixelIds.join(",")):"";return"".concat(n).concat(t," ")}function l(e,n){var t=d(),i=(null==n?void 0:n.enableDebug)||!1;if(t||i){var r=u(n);console.info("TTD Pixel v3: ".concat(r).concat(e))}}function v(e,n){var t=d(),i=(null==n?void 0:n.enableDebug)||!1;if(t||i){var r=u(n);console.error("TTD Pixel v3: ".concat(r).concat(e))}}var p=function(){return p=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},p.apply(this,arguments)},f=p({},t),g=p({},r);function h(e){if(f=p({},t),g=e,"function"==typeof window.__tcfapi){f.consentCheckExists=!0,f.waitForConsentTimeout=setTimeout(y,1e3),window.__tcfapi("addEventListener",f.tcfV2ConsentVersion,m),b("parse tcf response");var n="&gdpr=".concat(f.isGdprApplicable?1:0),i=null===f.gdprConsentString||void 0===f.gdprConsentString?"":"&gdpr_consent=".concat(f.gdprConsentString);return"".concat(n).concat(i)}b("tcfapi not a function")}function m(e,n){if(f.consentRequestHasTimedOut)return b("tcfapi consent request timed out"),void(f.isGdprApplicable=!0);n&&(clearTimeout(f.waitForConsentTimeout),f.isGdprApplicable=e.gdprApplies,f.gdprConsentString=e.tcString)}function y(){f.consentRequestHasTimedOut=!0}function b(e){(d()||g.enableDebug)&&console.info("TTD Pixel v3: "+e)}var w,_=function(){return _=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},_.apply(this,arguments)},k=null,E={gppString:""},I=_({},r);function T(){w=!0}function S(e){var n;return w?(x("gpp request timed out"),void window.__gpp("removeEventListener",null,e.listenerId)):"signalStatus"===e.eventName&&"ready"===e.data?(E.gppString=null===(n=null==e?void 0:e.pingData)||void 0===n?void 0:n.gppString,clearTimeout(k),window.__gpp("removeEventListener",null,e.listenerId),D(E)):void x("gpp event invalid")}function D(e){var n="&gpp_consent="+e.gppString;return"".concat(n)}function x(e){(d()||I.enableDebug)&&console.info("TTD Pixel v3: "+e)}function C(e,n,t){!function(e){var n=document.getElementById(e);do{n&&n.parentElement.removeChild(n),n=document.getElementById(e)}while(n)}(n);var i=document.createElement("iframe");function r(){document.body.appendChild(i)}return i.setAttribute("id",n),i.setAttribute("height","0"),i.setAttribute("width","0"),i.setAttribute("style","display:none;"),i.setAttribute("src",e),i.setAttribute("title",t),"complete"===document.readyState?setTimeout(r,0):window.addEventListener?window.addEventListener("load",r):window.attachEvent?window.attachEvent("onload",r):r(),i}function O(){var e=window,n="",t=!1;try{top.location.href&&(n=top.location.href)}catch(e){t=!0}if(t)for(;;)try{if(n=e.document.referrer,window.parent==e)break;e=window.parent}catch(e){break}return-1<n.indexOf("cloudfront.net")&&(n=function(e,n){n=n.replace(/\[/,"\\[").replace(/]/,"\\]");var t=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(e);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}(n,"url")||n),n}var L=function(){var e,n,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i={isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(n){if(!0===n&&0==--i.readyWait||!0!==n&&!i.isReady){if(!document.body)return setTimeout((function(){return i.ready()}),1);if(i.isReady=!0,!0!==n&&--i.readyWait>0)return;null==e||e.resolveWith(document,[i])}},bindReady:function(){if(!e){if(e=i._Deferred(),"complete"===document.readyState)return setTimeout((function(){return i.ready()}),1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",(function(){return i.ready()}),!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",n),window.attachEvent("onload",i.ready);var t=!1;try{t=null==window.frameElement}catch(e){console.log(e)}document.documentElement.doScroll&&t&&r()}}},_Deferred:function(){var e,n=[],t=!1,r=!1,o={done:function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];if(!r){var c=void 0;e&&(c=e,e=void 0);for(var s=0,d=t;s<d.length;s++){var u=d[s],l=i.type(u);"array"===l?o.done.apply(o,u):"function"===l&&n.push(u)}c&&o.resolveWith(c[0],c[1])}return o},resolveWith:function(i,a){if(void 0===a&&(a=[]),!r&&!e&&!t){t=!0;try{for(;n.length;){var c=n.shift();null==c||c.apply(i,a)}}finally{e=[i,a],t=!1}}return o},resolve:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return o.resolveWith(this,e)},isResolved:function(){return!(!t&&!e)},cancel:function(){return r=!0,n=[],o}};return o},type:function(e){return null==e?String(e):t[Object.prototype.toString.call(e)]||"object"}};function r(){if(!i.isReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(r,1)}i.ready()}}return document.addEventListener?n=function(){document.removeEventListener("DOMContentLoaded",n,!1),i.ready()}:document.attachEvent&&(n=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",n),i.ready())}),function(n){i.bindReady(),null==e||e.done(n)}}(),j=function(){return j=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},j.apply(this,arguments)},P=j({},r);function U(e,n){if(P=e,B("Detection started! Library is configured to detect: ",n.detectionSubject),B("Detection event type is ",n.detectionEventType),B("Full config: ",n),"onclick"===n.detectionEventType&&(n.detectionEventType="click"),"onsubmit"===n.detectionEventType||"click"===n.detectionEventType){var t=document.querySelector("body");t&&(A(t,"document",n),n.detectDynamicNodes&&G(t,"document",n))}else B("Detection type not supported! We will not start auto detection.")}function A(e,n,t){var i,r,o;t.scopedTriggers=null!==(i=t.scopedTriggers)&&void 0!==i?i:{},t.scopedValidInputs=null!==(r=t.scopedValidInputs)&&void 0!==r?r:{},t.scopedEventListeners=null!==(o=t.scopedEventListeners)&&void 0!==o?o:{},M(n,t),R(e,n,t)}function R(e,n,t){var i,r,o,a=H(e,n,t),c=H(e,n,t);t.scopedTriggers[n]=null!==(i=t.scopedTriggers[n])&&void 0!==i?i:[],t.scopedValidInputs[n]=null!==(r=t.scopedValidInputs[n])&&void 0!==r?r:[],t.scopedEventListeners[n]=null!==(o=t.scopedEventListeners[n])&&void 0!==o?o:[];for(var s=0,d=c;s<d.length;s++){var u=d[s];u&&u.tagName&&"INPUT"===u.tagName&&t.scopedValidInputs[n].push(u)}B('triggers ["'.concat(n,'"] '),a),B('validInputs ["'.concat(n,'"] '),c),a.forEach((function(e){t.scopedTriggers[n].push(e)}));for(var l=function(e){var i=function(){try{B("Detect event: ",t.detectionEventType,"on element, ",e);for(var n=Object.entries(t.scopedValidInputs).map((function(e){return e[1]})).flatMap((function(e){return e})),i=0,r=n;i<r.length;i++){var o=r[i].value.trim();if(F(o,t)){B("We detected: ",o),N(t);break}}}catch(e){B(e)}};t.scopedEventListeners[n].push(i),e.addEventListener(t.detectionEventType,i,{once:!0,capture:!0})},v=0,p=a;v<p.length;v++)l(p[v]);for(var f,g=(f=e,Array.from(f.querySelectorAll("*")).filter((function(e){return!!e.shadowRoot})).map((function(e){return e.shadowRoot}))),h=0;h<g.length;h++){var m=g[h],y=n+"/shadow_root_"+h;R(m,y,t),G(m,y,t)}}function N(e){B("Detection stopped."),function(e){if(e.detectDynamicNodes){B("Checking for dynamically added elements is turned off.");for(var n=0,t=Object.entries(e.scopedDynamicObservers);n<t.length;n++){var i=t[n][1];i&&i.disconnect(),e.scopedDynamicObservers={}}}}(e),M("all",e)}function M(e,n){if(B("clearing detection hooks (".concat(e,")")),"all"===e){for(var t=0,i=Object.entries(n.scopedTriggers);t<i.length;t++){var r=i[t],o=r[0];if(l=r[1])for(var a=0;a<l.length;a++)l[a].removeEventListener(n.detectionEventType,n.scopedEventListeners[o][a],{capture:!0})}n.scopedTriggers={},n.scopedEventListeners={}}else if(n.scopedTriggers){for(var c=[],s=0,d=Object.entries(n.scopedTriggers);s<d.length;s++){var u=d[s],l=(o=u[0],u[1]);if(o.startsWith(e)){if(l)for(a=0;a<l.length;a++)l[a].removeEventListener(n.detectionEventType,n.scopedEventListeners[o][a],{capture:!0});c.push(o)}}for(var v=0;v<c.length;v++)o=c[v],n.scopedTriggers[o]=[],n.scopedEventListeners[o]=[]}}function G(e,n,t){var i;t.detectDynamicNodes&&(t.scopedDynamicObservers=null!==(i=t.scopedDynamicObservers)&&void 0!==i?i:{},t.scopedDynamicObservers[n]=q((function(){B("Detected dynamically added nodes."),A(e,n,t)}),500),t.scopedDynamicObservers[n].observe(e,{childList:!0,subtree:!0,attributes:!0}))}function H(e,n,t){B('collectElements("'.concat(n,'", ').concat(t.cssSelectors,")"));for(var i=[],r=0,o=t.cssSelectors;r<o.length;r++)if((f=o[r]).length>0){var a=e.querySelectorAll(f);a&&a.forEach((function(e){i.includes(e)||i.push(e)}))}for(var c=window.location.hostname,s=document.getElementsByTagName("iframe"),d=0,u=Array.from(s);d<u.length;d++){var l=u[d];if(V(c,l)&&(l.__upixel_detection={root:e,scopeName:n+"/iframe",config:t},l.removeEventListener("load",W),l.addEventListener("load",W),l.contentDocument))for(var v=0,p=t.cssSelectors;v<p.length;v++){var f;(f=p[v]).length>0&&l.contentDocument.querySelectorAll(f).forEach((function(e){i.includes(e)||i.push(e)}))}}return i}function q(e,n){var t=0,i=null;return new MutationObserver((function(r,o){var a=Date.now(),c=a-t;c>=n?(t=a,e(r,o)):(i&&clearTimeout(i),i=setTimeout((function(){t=Date.now(),e(r,o)}),n-c))}))}function V(e,n){if(!n.src)return!1;try{var t=e===new URL(n.src).hostname;return t&&B("Iframe "+n.src+" can be accessed"),t}catch(e){return B("error: ",e),!1}}function W(e){var n=e.currentTarget;if(n&&n.__upixel_detection)try{A(n.__upixel_detection.root,n.__upixel_detection.scopeName,n.__upixel_detection.config)}catch(e){B(e)}}function F(e,n){return function(e,n){var t=/((([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,}))/i;if(n.detectionSubject.includes("email")&&t.test(e)){var i=function(e){return e.toLowerCase().trim()}(e.match(t)[0]);return B("We detected email: "+i),function(e,n){if(e&&n){var t=new CustomEvent("detected-identifier",{detail:{identifier:e,type:n}});B("Dispatched event with identifier: ",e," and type: ",n),window.dispatchEvent(t)}}(i,"email"),!0}return!1}(e,n)}function B(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];(d()||P.enableDebug)&&console.info("TTD Pixel v3 - Detection: "+e,n)}q.prototype.observe=function(e,n){this.mutationObserver.observe(e,n)},q.prototype.disconnect=function(){null!=this.nextTimeoutHandle&&clearTimeout(this.nextTimeoutHandle),this.mutationObserver.disconnect()},q.prototype.takeRecords=function(){return this.mutationObserver.takeRecords()},q.prototype.throttledCallback=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=Date.now();null!=this.args?this.args=e:this.lastInvocationTime+this.minDelayMs<t?(this.lastInvocationTime=t,this.callback(this.args)):(this.args=e,this.nextTimeoutHandle=setTimeout(function(){this.lastInvocationTime=Date.now(),this.nextTimeoutHandle=null,this.callback.apply(null,this.args),this.args=null}.bind(this),this.minDelayMs))};var J=function(){return J=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},J.apply(this,arguments)},K=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},z=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(e,a)}catch(e){o=[6,e],i=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},X=J({},r);function $(e,n,t){var i=this;X=e,ne(n,t),ee(n)?t.sdkObj=window.__uid2:Z(n)&&(t.sdkObj=window.__euid);try{t.sdkObj.callbacks.push((function(r,o){return K(i,void 0,void 0,(function(){var i,a,c;return z(this,(function(s){switch(s.label){case 0:switch(r){case"SdkLoaded":return[3,1];case"InitCompleted":return[3,2];case"IdentityUpdated":return[3,4]}return[3,5];case 1:try{window.__ttd_m_invoke_once=null!==(i=window.__ttd_m_invoke_once)&&void 0!==i?i:{},window.__ttd_m_invoke_once._uid_init||(window.__ttd_m_invoke_once._uid_init=1,null!==(a=n.baseUrl)&&void 0!==a||(n.baseUrl=t.uidBaseUrl),t.sdkObj.init({baseUrl:n.baseUrl}))}catch(e){te("Non-TTD actor initialized UID SDK, mind the consistency of UID baseUrl.",e)}return[3,5];case 2:return[4,Y((function(){return o.identity}),e,n,t)];case 3:return s.sent(),[3,5];case 4:return(null===(c=o.identity)||void 0===c?void 0:c.advertising_token)&&(n.uid_token=o.identity.advertising_token),[3,5];case 5:return[2]}}))}))}))}catch(e){ie("Did not setup uid hooks: ",e)}}function Q(e,n,t,i,r){void 0===window._uidSdkListenerLock[e]&&(window._uidSdkListenerLock[e]=1,ne(n,t),void 0===t.sdkObj&&void 0===window.uidSdkLoaderPromise?window.uidSdkLoaderPromise=new Promise((function(e,n){var o=document.createElement("script");o.setAttribute("defer","true"),o.setAttribute("src",t.uidSdkUrl),o.addEventListener("load",(function(){e(),i()})),o.addEventListener("error",(function(e){n(e),r(e)})),document.body.appendChild(o)})):K(this,void 0,void 0,(function(){return z(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,window.uidSdkLoaderPromise];case 1:return e.sent(),i(),[3,3];case 2:return ie("Failed to load uid sdk: ",e.sent()),[3,3];case 3:return[2]}}))})))}function Y(e,n,t,i){return K(this,void 0,void 0,(function(){var r,o,a;return z(this,(function(c){switch(c.label){case 0:return c.trys.push([0,8,,9]),(r=e())?[3,3]:t.email?[4,i.sdkObj.setIdentityFromEmail(t.email,t)]:[3,2];case 1:return c.sent(),[3,3];case 2:t.emailHash?i.sdkObj.setIdentityFromEmailHash(t.emailHash,t):t.phone?i.sdkObj.setIdentityFromPhone(t.phone,t):t.phoneHash&&i.sdkObj.setIdentityFromPhoneHash(t.phoneHash,t),c.label=3;case 3:return r?(t.uid_token=r.advertising_token,[3,7]):[3,4];case 4:return window.ttdConversionEvents.activeDetection?[3,7]:(te("in fire or detect no identity"),o=new Promise((function(e){window.addEventListener("detected-identifier",(function(n){e(n.detail.identifier),window.ttdConversionEvents.activeDetection=null})),window.ttdConversionEvents.startDetection=U,window.ttdConversionEvents.startDetection(n,t)})),window.ttdConversionEvents.activeDetection=o,[4,o]);case 5:return a=c.sent(),[4,i.sdkObj.setIdentityFromEmail(a,t)];case 6:return c.sent(),[3,7];case 7:return[3,9];case 8:return ie("error setting up cstgOrDetect: ",c.sent()),[3,9];case 9:return[2]}}))}))}function Z(e){return"EUID"===(null==e?void 0:e.type)||e.serverPublicKey.includes("EUID")}function ee(e){return"UID2"===(null==e?void 0:e.type)||e.serverPublicKey.includes("UID2")}function ne(e,n){ee(e)?(n.uidSdkUrl="https://js.adsrvr.org/uid2-sdk-4.0.1.js",n.uidBaseUrl="https://global.prod.uidapi.com",n.rtUidTokenName="uid2_token"):Z(e)&&(n.uidSdkUrl="https://js.adsrvr.org/euid-sdk-4.0.1.js",n.uidBaseUrl="https://prod.euid.eu",n.rtUidTokenName="euid_token")}function te(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];(d()||X.enableDebug)&&console.info("TTD Pixel v3 - UnifiedId: "+e,n)}function ie(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];(d()||X.enableDebug)&&console.warn("TTD Pixel v3 - UnifiedId: "+e,n)}function re(){var e={};return document.cookie.split(";").forEach((function(n){if(n){var t=n.split("="),i=t[0].trim(),r=t[1].trim();e[i]=r}})),e}function oe(e,n){(d()||e)&&console.warn("TTD Pixel v3 - GA4: "+n)}var ae=function(e,n,t){if(t||2===arguments.length)for(var i,r=0,o=n.length;r<o;r++)!i&&r in n||(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return e.concat(i||Array.prototype.slice.call(n))};function ce(e){var n=window.ttdConversionEventsLayer.indexOf(e);-1!==n&&window.ttdConversionEventsLayer.splice(n,1)}function se(e){var n=e.config;if(!n)throw"Cannot execute event without config";switch(e.method){case"event":l("event fire triggered",n),ye(e.params,n,!0);break;case"optout":l("optout triggered",n),e.params.isoptout="1",ye(e.params,n,!1);break;default:throw l("unexpected event triggered: "+e.method,n),"method not implemented"}}var de,ue=function(){return ue=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},ue.apply(this,arguments)},le=function(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}))},ve=function(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(e,a)}catch(e){o=[6,e],i=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},pe=new Map,fe=new Map,ge=[];function he(e){var n=e[0],t=e[1];if("init"===n){l("init triggered");try{!function(e){var n,t,d,u,l,p,f,g,h,m=e.merchantId,y=e.advertiserId,b=e.enableCookieSyncing,w=e.enableDebug,_=e.rootUrl,k=e.dataProcessingOption,E=e.uidConfig,I=e.pixelIds,T=e.referrerUrl,S=e.ga4MeasurementId;le(this,void 0,void 0,(function(){var e,D;return ve(this,(function(x){switch(x.label){case 0:if(e=function(e,n,t,o){for(var c,s=(null==o?void 0:o.length)>0?o.map((function(e){return a(n,t,e)})):[a(n,t)],d=0,u=s;d<u.length;d++){var l=u[d];if(c=e.get(l))break}c||(c=i({},r));for(var v=0,p=s;v<p.length;v++)l=p[v],e.set(l,c);return c}(pe,y,m,I),e.merchantId=null!=m?m:e.merchantId,e.advertiserId=null!=y?y:e.advertiserId,!function(e,n){return o(e)||o(n)}(e.advertiserId,e.merchantId))return v("Init failed: At least one valid identifier (advertiserId or merchantId) is required."),[2];e.enableCookieSyncing=null!==(n=null!=b?b:e.enableCookieSyncing)&&void 0!==n?n:r.enableCookieSyncing,e.enableDebug=null!==(d=null!==(t=null!=w?w:e.enableDebug||void 0)&&void 0!==t?t:s())&&void 0!==d?d:null!=localStorage.getItem("enable-ttd-pixel-debugging")||r.enableDebug,e.rootUrl=null!==(u=null!=_?_:e.rootUrl)&&void 0!==u?u:r.rootUrl,e.dataProcessingOption=null!==(l=null!=k?k:e.dataProcessingOption)&&void 0!==l?l:r.dataProcessingOption,e.uidConfig=null!==(p=null!=E?E:e.uidConfig)&&void 0!==p?p:void 0,e.pixelIds=null!==(f=null!=I?I:e.pixelIds)&&void 0!==f?f:void 0,e.ga4MeasurementId=null!==(g=null!=S?S:e.ga4MeasurementId)&&void 0!==g?g:void 0,e.referrerUrl=null!==(h=null!=T?T:e.referrerUrl)&&void 0!==h?h:void 0,D=new Promise((function(e){return setTimeout(e,2e3)})),x.label=1;case 1:return x.trys.push([1,3,4,5]),[4,Promise.race([me(e),D])];case 2:return x.sent(),[3,5];case 3:return v(x.sent(),e),[3,5];case 4:return e.initComplete=!0,function(e,n){for(var t,i,r=[],o=0,a=e;o<a.length;o++){var s=a[o];null!==(t=s.config)&&void 0!==t||(s.config=c(n,s.params.adv,s.params.merchant_id,s.params.pixel_ids)),(null===(i=s.config)||void 0===i?void 0:i.initComplete)?(se(s),ce(s.args)):r.push(s)}e.splice.apply(e,ae([0,e.length],r,!1))}(ge,pe),[7];case 5:return[2]}}))}))}(t)}catch(e){v("Init failed: ".concat(e instanceof Error?e.message:String(e)))}ce(e)}else{var d=c(pe,t.adv,t.merchant_id,t.pixel_ids),u={method:n,params:t,args:e,config:d};(null==d?void 0:d.initComplete)?(se(u),ce(e)):function(e,n){var t=n.params;n.config||l("No matching config found for event, queuing until init completes"),e.push(n),setTimeout((function(){var i;if(e.includes(n)){var r=t.adv?"adv: ".concat(t.adv):t.merchant_id?"merchant_id: ".concat(t.merchant_id):"unknown",o=(null===(i=t.pixel_ids)||void 0===i?void 0:i.join(","))||"none";v("Event not fired after 5s. No matching config for ".concat(r,", pixel_ids: [").concat(o,"]. ")+"Ensure init is called with matching advertiserId/merchantId and pixelIds.")}}),5e3)}(ge,u)}}function me(e){return new Promise((function(n){var t,i,r,o,a="".concat(e.rootUrl,"/track/cei"),c=void 0!==e.merchantId&&null!==e.merchantId?"merchant_id=".concat(e.merchantId):"advertiser_id=".concat(e.advertiserId),s="&cookie_sync=".concat(e.enableCookieSyncing?1:0),v="".concat(a,"?").concat(c).concat(s,"&upv=").concat(e.pixelVersion);null!=e.dataProcessingOption&&(v+="&dpop=".concat(e.dataProcessingOption.policies,"&dpor=").concat(e.dataProcessingOption.region)),e.pixelIds&&(v+="&upid=".concat(e.pixelIds.join(",")));var p=(null!==(t=e.advertiserId)&&void 0!==t?t:e.merchantId)+":"+(null!==(r=null===(i=e.pixelIds)||void 0===i?void 0:i.join(","))&&void 0!==r?r:""),f=function(e,n){var t=n.get(e);return t||(t={},n.set(e,t)),t}(p,fe);e.uidConfig?(v+="&uidc_present=1",window._uidSdkListenerLock=null!==(o=window._uidSdkListenerLock)&&void 0!==o?o:{},l("setting up uid config",e),Q(p,e.uidConfig,f,(function(){return $(e,e.uidConfig,f)}),(function(n){return function(e,n){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var r=d(),o=(null==n?void 0:n.enableDebug)||!1;if(r||o){var a=u(n);console.warn("TTD Pixel v3: ".concat(a).concat(e),t)}}("UID enabled but failed to register hooks: ",e,n)}))):window.addEventListener("message",(function(n){!function(e,n,t){var i;try{var r;if(null!==e.origin&&"null"!==e.origin&&new URL(e.origin).hostname.endsWith(".adsrvr.org")&&"string"==typeof e.data){var o=JSON.parse(e.data);!o.type||"string"!=typeof o.type||"UID2"!==o.type&&"EUID"!==o.type||o.advertiserId&&"string"==typeof o.advertiserId&&o.advertiserId==n.advertiserId&&(window._uidSdkListenerLock=null!==(i=window._uidSdkListenerLock)&&void 0!==i?i:{},n.uidConfig=o,Q(o.advertiserId+":"+o.pixelId,n.uidConfig,t,(function(){return $(n,n.uidConfig,t)}),(function(e){ie("UID enabled but failed to register hooks: ",e)})))}}catch(r){ie(r)}}(n,e,f)}));var g=h(e);if(null!=g)v+="".concat(g);else{var m=function(e){if(I=e,"function"==typeof window.__gpp)return void 0!==(E=function(){var e=window.__gpp("ping");if("1.0"==e.gppVersion){var n=window.__gpp("getGPPData");E.gppString=null==n?void 0:n.gppString}else E.gppString=null==e?void 0:e.gppString;return E}()).gppString?(x("gpp response already loaded, parse response"),D(E)):(k=setTimeout(T,1e3),w=!1,window.__gpp("addEventListener",S),void 0!==E.gppString?(x("gpp response received, parse response"),D(E)):void 0);x("gpp not a function")}(e);v+="".concat(null!=m?m:"")}e.enableDebug&&(v+="&debug=1");var y=e.referrerUrl||O();v+="&ref=".concat(y);var b="universal_pixel";e.pixelIds&&(b+="_"+e.pixelIds.join("_")),l("trigger GET conversion init call",e),C(v,b,"TTD Universal Pixel").onload=function(){return n()}}))}function ye(e,n,t){var i,r,o,a,c,s=null!==(i=e.privacy_settings)&&void 0!==i?i:[],d=function(){var e;if(f.consentCheckExists)return{privacy_type:"GDPR",is_applicable:f.isGdprApplicable,consent_string:null!==(e=f.gdprConsentString)&&void 0!==e?e:""};b("tcfapi consent status check failed")}(),u=function(){if(""!=E.gppString&&null!=E.gppString)return{privacy_type:"GPP",is_applicable:!0,consent_string:E.gppString}}();if(t&&(d?(s=s.filter((function(e){return e.privacy_type!==d.privacy_type})),e.gdpr=d.is_applicable,e.gdpr_consent=d.consent_string):u&&(s=s.filter((function(e){return e.privacy_type!==u.privacy_type})),e.gpp_consent=u.consent_string)),void 0===n.merchantId||null===n.merchantId||e.merchant_id?void 0===n.advertiserId||null===n.advertiserId||e.adv||(e.adv=n.advertiserId):e.merchant_id=n.merchantId,void 0!==n.ga4MeasurementId){var p=function(e){var n=re()._ga;if(!n||!n.startsWith("GA"))return oe(e,"_ga cookie not found or malformed"),null;var t=n.split(".");return 4===t.length?t[2]+"."+t[3]:(oe(e,"Unexpected _ga cookie format:"+n),null)}(n.enableDebug),g=function(e,n){var t=re()["_ga_"+(n=n.startsWith("G-")?n.split("-")[1]:n)];if(!t||!t.startsWith("GS"))return oe(e,"_ga_"+n+" cookie not found or malformed"),null;var i=t.split("."),r=i[0].includes("2"),o=i[2];return r?o.split("$")[0].slice(1):o}(n.enableDebug,n.ga4MeasurementId);p&&g&&(e.ga_client_id=p,e.ga_session_id=g)}n.enableDebug&&(e.debug="1"),null!==(r=e.data_processing_option)&&void 0!==r||(e.data_processing_option=n.dataProcessingOption),null!==(o=e.pixel_ids)&&void 0!==o||(e.pixel_ids=n.pixelIds),null!==(a=e.referrer_url)&&void 0!==a||(e.referrer_url=O()),(null===(c=n.uidConfig)||void 0===c?void 0:c.uid_token)&&(ee(n.uidConfig)?e.uid2_token=n.uidConfig.uid_token:Z(n.uidConfig)&&(e.euid_token=n.uidConfig.uid_token));var h={data:[ue(ue({},e),{privacy_settings:s})]};n.enableDebug&&(h.debug="1"),function(e,n,t){var i=this,r="".concat(e.rootUrl,"/track/realtimeconversion");return l("trigger POST realtime conversion event",e),new Promise((function(o,a){var c=new XMLHttpRequest;c.withCredentials=!0,c.open("POST",r),c.setRequestHeader("Content-type","application/json"),c.setRequestHeader("eventDataSource","JsSdk"),c.setRequestHeader("eventDataSourceVersion",e.pixelVersion),c.onload=function(){if(c.status>=200&&c.status<300)o(c.response);else{var i=ke(c);a(c.response),be(e,n,t,i)}},c.onerror=function(){return le(i,void 0,void 0,(function(){var i;return ve(this,(function(r){return i=ke(c),a(c.statusText),be(e,n,t,i),[2]}))}))},c.send(JSON.stringify(n))}))}(n,h,e).catch((function(e){return v(e,n)}))}function be(e,n,t,i){var r,o,a,c;return le(this,void 0,void 0,(function(){var s,d,u,v;return ve(this,(function(p){var f,g;return s="universal_pixel_realtime_fallback_"+(null!==(c=null!==(o=null===(r=t.pixel_ids)||void 0===r?void 0:r.join("_"))&&void 0!==o?o:null===(a=e.pixelIds)||void 0===a?void 0:a.join("_"))&&void 0!==c?c:""),l("trigger GET realtime conversion event fallback",e),f=n.data[0],g=Object.entries(f).filter((function(e){var n=e[0],t=e[1];return("string"==typeof t||"number"==typeof t||"boolean"==typeof t||"pixel_ids"===n)&&null!=t&&""!==t})),d=g.map((function(e){var n=e[0],t=e[1];return"".concat(n,"=").concat(t)})).join("&"),u=e.pixelVersion,v="".concat(e.rootUrl,"/track/rt"),""!==d&&(v+="?"+d+"&eds=".concat("JsSdkGet")+"&edsv=".concat(u)+"&rt_fallback=1"),""!==i&&(v+="&rt_fbErr=".concat(i)),C(v,s,"TTD Universal Pixel Realtime Fallback"),[2]}))}))}function we(e,n,t,i,r,o){return le(this,void 0,void 0,(function(){var a,s,d,u,v;return ve(this,(function(p){if(!e||""==e||!n||n.length<=0)return l("no advertiser id or pixel id given"),[2];if(a="https://"+new URL(t).hostname,s={advertiserId:e,pixelIds:n,rootUrl:a,uidConfig:r,referrerUrl:o},d={adv:e,pixel_ids:n,referrer_url:o},i)for(u in i)v=i[u],"cookie_sync"===u?s.enableCookieSyncing="1"===v:void 0!==v&&(d[u]="fmt"===u&&"number"==typeof v?v.toString():v),"fmt"!==u||"4"!==v&&4!==v||(s.enableCookieSyncing=!1);return window.ttdConversionEventsLayer.push(["init",s]),setTimeout((function(){var t,i=c(pe,e,null,n);!window._uidSdkListenerLock||(null===(t=null==i?void 0:i.uidConfig)||void 0===t?void 0:t.uid_token)?window.ttdConversionEventsLayer.push(["event",d]):document.addEventListener("visibilitychange",(function(){return _e(d,e,n)}))}),1e3),[2]}))}))}function _e(e,n,t){return le(this,void 0,void 0,(function(){var i;return ve(this,(function(r){return"hidden"===document.visibilityState&&((i=c(pe,n,null,t))&&ye(e,i,!1),document.removeEventListener("visibilitychange",_e)),[2]}))}))}function ke(e){var n,t=null!==(n=e.responseText)&&void 0!==n?n:JSON.parse(e.responseText);return(null==t?void 0:t.Message)?t.Message:0!==e.status||e.responseText?"Status Code ".concat(e.status):"Request never hit server. Possible CSP violation."}function Ee(){pe.clear(),fe.clear(),ge.length=0}window.ttdConversionEventsLayer=window.ttdConversionEventsLayer||[],window.ttdConversionEvents=null!==(de=window.ttdConversionEvents)&&void 0!==de?de:{activeDetection:null,startDetection:null},window.ttdConversionEventsLayer.forEach(he),window.ttdConversionEventsLayer.push=function(e){return Array.prototype.push.call(window.ttdConversionEventsLayer,e),he(e),this.length},window.ttd_dom_ready=L,window.TTDUniversalPixelApi=function(e){this.init=function(n,t,i,r,o){we(null!=n?n:void 0,null!=t?t:void 0,null!=i?i:void 0,null!=r?r:void 0,null!=o?o:void 0,null!=e?e:void 0)}},window.ttd_up_api={topLevelUrl:"",set_top_level_url:function(e){this.topLevelUrl=e},init:function(e,n,t,i,r){we(e,n,t,i,r,this.topLevelUrl)}},TTDConversionEvents=n})();