






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>Reusable And Extensible Python Functions For Financial Data Analysis &middot; Jared Szajkowski</title>
    <meta name="title" content="Reusable And Extensible Python Functions For Financial Data Analysis &middot; Jared Szajkowski" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js"
    integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/css/main.bundle.min.849ae3cca8bfa5452a322fbcb668aa1b8ef9f9b3c3f7df5edc4a8bd0ca5728b4.css"
    integrity="sha256-hJrjzKi/pUUqMi&#43;8tmiqG475&#43;bPD999e3EqL0MpXKLQ="
  />
  
    
    
    
  
  
    
    
    
  
  
    
    
  
  
    
    
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/js/main.bundle.min.3deb0a38c81305c3cd8231a82b0c41525e4c2546c727c39d3ed6d12564664993.js"
      integrity="sha256-PesKOMgTBcPNgjGoKwxBUl5MJUbHJ8OdPtbRJWRmSZM="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      A list of common functions used for data acquisition, cleaning, analysis, etc.
    "
  />
  
  
  
  
    <link rel="canonical" href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/" />
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/jaredszajkowski.github.io_congo/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/jaredszajkowski.github.io_congo/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/jaredszajkowski.github.io_congo/favicon-16x16.png" />
    <link rel="manifest" href="/jaredszajkowski.github.io_congo/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/">
  <meta property="og:site_name" content="Jared Szajkowski">
  <meta property="og:title" content="Reusable And Extensible Python Functions For Financial Data Analysis">
  <meta property="og:description" content="A list of common functions used for data acquisition, cleaning, analysis, etc.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-02T00:00:01+00:00">
    <meta property="article:modified_time" content="2025-07-28T00:00:01+00:00">
    <meta property="og:image" content="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover.jpg">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover.jpg">
  <meta name="twitter:title" content="Reusable And Extensible Python Functions For Financial Data Analysis">
  <meta name="twitter:description" content="A list of common functions used for data acquisition, cleaning, analysis, etc.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Reusable And Extensible Python Functions For Financial Data Analysis",
    "headline": "Reusable And Extensible Python Functions For Financial Data Analysis",
    "description": "A list of common functions used for data acquisition, cleaning, analysis, etc.",
    "abstract": "A list of common functions used for data acquisition, cleaning, analysis, etc.",
    "inLanguage": "en",
    "url" : "https:\/\/jaredszajkowski.github.io\/jaredszajkowski.github.io_congo\/posts\/reusable-extensible-python-functions-financial-data-analysis\/",
    "author" : {
      "@type": "Person",
      "name": "Jared Szajkowski"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-02-02T00:00:01\u002b00:00",
    "datePublished": "2025-02-02T00:00:01\u002b00:00",
    
    "dateModified": "2025-07-28T00:00:01\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "7853"
  }
  </script>
    
    <script type="application/ld+json">
    {
   "@context": "https://schema.org",
   "@type": "BreadcrumbList",
   "itemListElement": [
     {
       "@type": "ListItem",
       "item": "https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/",
       "name": "Jared Szajkowski",
       "position": 1
     },
     {
       "@type": "ListItem",
       "item": "https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/",
       "name": "Posts",
       "position": 2
     },
     {
       "@type": "ListItem",
       "name": "Reusable and Extensible Python Functions for Financial Data Analysis",
       "position": 3
     }
   ]
 }
  </script>

  
  
    <meta name="author" content="Jared Szajkowski" />
  
  
    
      <link href="mailto:jared.szajkowski@gmail.com" rel="me" />
    
      <link href="https://github.com/jaredszajkowski" rel="me" />
    
      <link href="https://linkedin.com/in/jaredszajkowski" rel="me" />
    
  
  
  







  
  
  
  
  
  


  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="z-40 flex flex-row items-center">
      
    <a href="/jaredszajkowski.github.io_congo/" class="mr-2">
      
      <img
        src="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/mountain.png"
        width="120"
        height="120"
        class="max-h-[10rem] max-w-[10rem] object-scale-down object-left
        dark:hidden flex"
        alt="Jared Szajkowski"
      />
        <img
          src="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/mountain-dark.png"
          width="120"
          height="120"
          class="hidden max-h-[10rem] max-w-[10rem] object-scale-down object-left dark:flex"
          alt="Jared Szajkowski"
        />
    </a>
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/jaredszajkowski.github.io_congo/"
    >Jared Szajkowski</a
  >

    </div>
    
      
      <label id="menu-button" for="menu-controller" class="block sm:hidden">
        <input type="checkbox" id="menu-controller" class="hidden" />
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"
        >
          <ul
            class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"
          >
            <li class="mb-1">
              <span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"
                ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span></span
              >
            </li>
            
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/jaredszajkowski.github.io_congo/posts/"
                      title="Posts"
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Blog</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/jaredszajkowski.github.io_congo/topics/"
                      title="Topics"
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Topics</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/jaredszajkowski.github.io_congo/links/"
                      title="Links"
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Links</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/jaredszajkowski.github.io_congo/about-me/"
                      title="About Me"
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >About Me</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    <button
                      id="appearance-switcher-1"
                      type="button"
                      aria-label="appearance switcher"
                    >
                      <span
                        class="group-dark:hover:text-primary-400 inline transition-colors group-hover:text-primary-600 dark:hidden"
                        title="Switch to dark appearance"
                      >
                        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </span>
                      <span
                        class="group-dark:hover:text-primary-400 hidden transition-colors group-hover:text-primary-600 dark:inline"
                        title="Switch to light appearance"
                      >
                        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </span>
                    </button>
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    
                      <button
                        id="search-button-1"
                        title="Search (/)"
                      >
                        
                          <span
                            class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                          ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </button>
                    
                  
                </li>
              
                
                  
              
            
          </ul>
        </div>
      </label>
      
      <ul class="hidden list-none flex-row text-end sm:flex">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/jaredszajkowski.github.io_congo/posts/"
                  title="Posts"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/jaredszajkowski.github.io_congo/topics/"
                  title="Topics"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Topics</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/jaredszajkowski.github.io_congo/links/"
                  title="Links"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Links</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/jaredszajkowski.github.io_congo/about-me/"
                  title="About Me"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >About Me</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                <button
                  id="appearance-switcher-2"
                  type="button"
                  aria-label="appearance switcher"
                >
                  <span
                    class="group-dark:hover:text-primary-400 inline transition-colors group-hover:text-primary-600 dark:hidden"
                    title="Switch to dark appearance"
                  >
                    <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </span>
                  <span
                    class="group-dark:hover:text-primary-400 hidden transition-colors group-hover:text-primary-600 dark:inline"
                    title="Switch to light appearance"
                  >
                    <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </span>
                </button>
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                
                  <button
                    id="search-button-2"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
            
              
          

        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Reusable And Extensible Python Functions For Financial Data Analysis
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  
    
  

  
    
  

  
    
  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-02-02 00:00:01 &#43;0000 &#43;0000">February 2, 2025</time><span class="px-2 text-primary-500">&middot;</span><time datetime="2025-07-28 00:00:01 &#43;0000 &#43;0000">Updated: July 28, 2025</time><span class="px-2 text-primary-500">&middot;</span><span>7853 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">37 mins</span>
    

    
    
  </div>

  
  
    <div class="my-1 flex flex-wrap text-xs leading-relaxed text-neutral-500 dark:text-neutral-400">
      
        
          
            <a
              href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/topics/bloomberg/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >Bloomberg</a
            >
          
            <a
              href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/topics/nasdaq-data-link/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >Nasdaq Data Link</a
            >
          
            <a
              href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/topics/pandas/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >Pandas</a
            >
          
            <a
              href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/topics/python/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >Python</a
            >
          
            <a
              href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/topics/yahoo-finance/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >Yahoo Finance</a
            >
          
        
      
    </div>
  


        </div>
      
      
        <div class="prose">
          
          
          
          








  
    <picture
      class="mb-6 rounded-md"
      
    >
      
      
      
      
        <source
          
            srcset="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_613fe027ed387d56.webp 330w,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_ad46a6ac3f75e4de.webp 660w
            
              ,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_27802cbd32266fd0.webp 1024w
            
            
              ,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_b3b96d85a3349607.webp 1320w
            "
          
          sizes="100vw"
          type="image/webp"
        />
      
      <img
        width="1920"
        height="800"
        class="mb-6 rounded-md"
        
        
        
          src="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_fc89f14bd0bdd1ac.jpg" srcset="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_6dbc768165ca517.jpg 330w,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_fc89f14bd0bdd1ac.jpg 660w
          
            ,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_89aaf53afbf302f4.jpg 1024w
          
          
            ,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/cover_hu_fc1821294a6a10fa.jpg 1320w
          "
          sizes="100vw"
        
      />
    </picture>
  


          
            <figcaption class="-mt-3 mb-6 text-center">Image generated by AI. Copyrights maintained by respective entities.</figcaption>
          
        </div>
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
        <div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8">
          <div class="toc pe-5 lg:sticky lg:top-10 print:hidden">
            <details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5">
  <summary
    class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden"
  >
    Table of Contents
  </summary>
  <div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#function-index">Function Index</a></li>
    <li><a href="#python-functions">Python Functions</a>
      <ul>
        <li><a href="#bb_clean_data">bb_clean_data</a></li>
        <li><a href="#build_index">build_index</a></li>
        <li><a href="#calc_vix_trade_pnl">calc_vix_trade_pnl</a></li>
        <li><a href="#coinbase_fetch_available_products">coinbase_fetch_available_products</a></li>
        <li><a href="#coinbase_fetch_full_history">coinbase_fetch_full_history</a></li>
        <li><a href="#coinbase_fetch_historical_candles">coinbase_fetch_historical_candles</a></li>
        <li><a href="#coinbase_pull_data">coinbase_pull_data</a></li>
        <li><a href="#df_info">df_info</a></li>
        <li><a href="#df_info_markdown">df_info_markdown</a></li>
        <li><a href="#export_track_md_deps">export_track_md_deps</a></li>
        <li><a href="#load_api_keys">load_api_keys</a></li>
        <li><a href="#load_data">load_data</a></li>
        <li><a href="#pandas_set_decimal_places">pandas_set_decimal_places</a></li>
        <li><a href="#plot_timeseries">plot_timeseries</a></li>
        <li><a href="#plot_stats">plot_stats</a></li>
        <li><a href="#plot_vix_with_trades">plot_vix_with_trades</a></li>
        <li><a href="#polygon_fetch_full_history">polygon_fetch_full_history</a></li>
        <li><a href="#polygon_pull_data">polygon_pull_data</a></li>
        <li><a href="#strategy_harry_brown_perm_port">strategy_harry_brown_perm_port</a></li>
        <li><a href="#summary_stats">summary_stats</a></li>
        <li><a href="#yf_pull_data">yf_pull_data</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
    <li><a href="#code">Code</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <h2 id="introduction" class="relative group">Introduction <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#introduction" aria-label="Anchor">#</a></span></h2><p>This post intends to provide the code for all of the python functions that I use in my analysis. The goal here is that when writing another post I will simply be able to link to the functions below as opposed to providing the function code in each post.</p>
<h2 id="function-index" class="relative group">Function Index <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#function-index" aria-label="Anchor">#</a></span></h2><ul>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#bb_clean_data">bb_clean_data</a>: Takes an Excel export from Bloomberg, removes the miscellaneous headings/rows, and returns a DataFrame.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#build_index">build_index</a>: Reads the <code>index_temp.md</code> markdown file, inserts the markdown dependencies where indicated, and then saves the file as <code>index.md</code>.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#calc_vix_trade_pnl">calc_vix_trade_pnl</a>: Calculates the profit/loss from VIX options trades.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#coinbase_fetch_available_products">coinbase_fetch_available_products</a>: Fetch available products from Coinbase Exchange API.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#coinbase_fetch_full_history">coinbase_fetch_full_history</a>: Fetch full historical data for a given product from Coinbase Exchange API.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#coinbase_fetch_historical_candles">coinbase_fetch_historical_candles</a>: Fetch historical candle data for a given product from Coinbase Exchange API.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#coinbase_pull_data">coinbase_pull_data</a>: Update existing record or pull full historical data for a given product from Coinbase Exchange API.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#df_info">df_info</a>: A simple function to display the information about a DataFrame and the first five rows and last five rows.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#df_info_markdown">df_info_markdown</a>: Similar to the <code>df_info</code> function above, except that it coverts the output to markdown.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#export_track_md_deps">export_track_md_deps</a>: Exports various text outputs to markdown files, which are included in the <code>index.md</code> file created when building the site with Hugo.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#load_data">load_data</a>: Load data from a CSV, Excel, or Pickle file into a pandas DataFrame.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#pandas_set_decimal_places">pandas_set_decimal_places</a>: Set the number of decimal places displayed for floating-point numbers in pandas.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#plot_timeseries">plot_timeseries</a>: Plot the price data from a DataFrame for a specified date range and columns.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#plot_stats">plot_stats</a>: Generate a scatter plot for the mean OHLC prices.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#plot_vix_with_trades">plot_vix_with_trades</a>: Plot the VIX daily high and low prices, along with the VIX spikes, and trades.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#polygon_fetch_full_history">polygon_fetch_full_history</a>: Fetch full historical data for a given product from Polygon API.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#polygon_pull_data">polygon_pull_data</a>: Read existing data file, download price data from Polygon, and export data.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#strategy_harry_brown_perm_port">strategy_harry_brown_perm_port</a>: Execute the strategy for the Harry Brown permanent portfolio.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#summary_stats">summary_stats</a>: Generate summary statistics for a series of returns.</br></li>
<li>
      
    <a href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/#yf_pull_data">yf_pull_data</a>: Download daily price data from Yahoo Finance and export it.</li>
</ul>
<h2 id="python-functions" class="relative group">Python Functions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#python-functions" aria-label="Anchor">#</a></span></h2><h3 id="bb_clean_data" class="relative group">bb_clean_data <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#bb_clean_data" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bb_clean_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_ticker_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function takes an excel export from Bloomberg and removes all excess data 
</span></span></span><span class="line"><span class="cl"><span class="s2">    leaving date and close columns.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to store downloaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    fund : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The fund to clean the data from.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Bloomberg&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing cleaned data prices.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set location from where to read existing excel file</span>
</span></span><span class="line"><span class="cl">    <span class="n">location</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/Daily/</span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">.xlsx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Read data from excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span><span class="s2">&#34;Worksheet&#34;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;calamine&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;File not found...please download the data for </span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the column headings from row 5 (which is physically row 6)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the column heading for the index to be &#34;None&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Drop the first 6 rows, 0 - 5</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Set the date column as the index</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Drop the volume column</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PX_VOLUME&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Rename column</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PX_LAST&#39;</span><span class="p">:</span><span class="s1">&#39;Close&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Sort by date</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create directory</span>
</span></span><span class="line"><span class="cl">    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/Daily&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">_Clean.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">_Clean.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The first and last date of data for </span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2"> is: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Bloomberg data cleaning complete for </span><span class="si">{</span><span class="n">fund_ticker_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;--------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span></code></pre></div><h3 id="build_index" class="relative group">build_index <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#build_index" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">build_index</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Build a Hugo-compatible index.md by combining Markdown fragments.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function reads a template file (`index_temp.md`) and a list of markdown dependencies 
</span></span></span><span class="line"><span class="cl"><span class="s2">    from `index_dep.txt`. For each entry in the dependency list, it replaces a corresponding 
</span></span></span><span class="line"><span class="cl"><span class="s2">    placeholder in the template (formatted as &lt;!-- INSERT_&lt;name&gt;_HERE --&gt;) with the content 
</span></span></span><span class="line"><span class="cl"><span class="s2">    from the markdown file. If a file is missing, the placeholder is replaced with a warning note.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Output:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    - Writes the final assembled content to `index.md`.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Raises:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    FileNotFoundError:
</span></span></span><span class="line"><span class="cl"><span class="s2">        If either `index_temp.md` or `index_dep.txt` does not exist.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    If `index_dep.txt` contains:
</span></span></span><span class="line"><span class="cl"><span class="s2">        01_intro.md
</span></span></span><span class="line"><span class="cl"><span class="s2">        02_analysis.md
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    And `index_temp.md` contains:
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;!-- INSERT_01_intro_HERE --&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;!-- INSERT_02_analysis_HERE --&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    The resulting `index.md` will include the contents of the respective markdown files in place 
</span></span></span><span class="line"><span class="cl"><span class="s2">    of their placeholders.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">temp_index_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&#34;index_temp.md&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_index_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&#34;index.md&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dependencies_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&#34;index_dep.txt&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Read the index template</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_index_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&#34;Missing index_temp.md&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">temp_index_content</span> <span class="o">=</span> <span class="n">temp_index_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Read dependency list</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">dependencies_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&#34;Missing index_dep.txt&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">dependencies_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">markdown_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Replace placeholders for each dependency</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_index_content</span> <span class="o">=</span> <span class="n">temp_index_content</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">md_file</span> <span class="ow">in</span> <span class="n">markdown_files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">placeholder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;&lt;!-- INSERT_</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">md_file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_HERE --&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">md_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">md_file</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">final_index_content</span> <span class="o">=</span> <span class="n">final_index_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">placeholder</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Warning: </span><span class="si">{</span><span class="n">md_file</span><span class="si">}</span><span class="s2"> not found, skipping placeholder </span><span class="si">{</span><span class="n">placeholder</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">final_index_content</span> <span class="o">=</span> <span class="n">final_index_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">placeholder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&#34;*</span><span class="si">{</span><span class="n">md_file</span><span class="si">}</span><span class="s2"> not found*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Write final index.md</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_index_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">final_index_content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34; index.md successfully built!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">build_index</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="calc_vix_trade_pnl" class="relative group">calc_vix_trade_pnl <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#calc_vix_trade_pnl" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calc_vix_trade_pnl</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">transaction_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">exp_start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">exp_end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">trade_start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">trade_end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Calculate the profit and loss (PnL) of trades based on transaction data.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    transaction_df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing transaction data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    exp_start_date : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start date for filtering transactions in &#39;YYYY-MM-DD&#39; format. This is the start of the range for the option expiration date.
</span></span></span><span class="line"><span class="cl"><span class="s2">    exp_end_date : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        End date for filtering transactions in &#39;YYYY-MM-DD&#39; format. This is the end of the range for the option expiration date.
</span></span></span><span class="line"><span class="cl"><span class="s2">    trade_start_date : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start date for filtering transactions in &#39;YYYY-MM-DD&#39; format. This is the start of the range for the trade date.
</span></span></span><span class="line"><span class="cl"><span class="s2">    trade_end_date : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        End date for filtering transactions in &#39;YYYY-MM-DD&#39; format. This is the end of the range for the trade date.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    transactions_data : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dataframe containing the transactions for the specified timeframe.
</span></span></span><span class="line"><span class="cl"><span class="s2">    closed_trades : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing the closed trades with realized PnL and percent PnL.
</span></span></span><span class="line"><span class="cl"><span class="s2">    open_trades : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing the open trades.
</span></span></span><span class="line"><span class="cl"><span class="s2">    net_PnL_percent_str : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        String representation of the net profit percentage.
</span></span></span><span class="line"><span class="cl"><span class="s2">    net_PnL_str : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        String representation of the net profit and loss in dollars.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If start and end dates for trades and expirations are None, use the entire DataFrame</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">exp_start_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exp_end_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trade_start_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trade_end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">transactions_data</span> <span class="o">=</span> <span class="n">transaction_df</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># If both start and end dates for trades and expirations are provided then filter by both</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">transactions_data</span> <span class="o">=</span> <span class="n">transaction_df</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="n">transaction_df</span><span class="p">[</span><span class="s1">&#39;Exp_Date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">exp_start_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">transaction_df</span><span class="p">[</span><span class="s1">&#39;Exp_Date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">exp_end_date</span><span class="p">)</span> <span class="o">&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="n">transaction_df</span><span class="p">[</span><span class="s1">&#39;Trade_Date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">trade_start_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">transaction_df</span><span class="p">[</span><span class="s1">&#39;Trade_Date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">trade_end_date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Combine the &#39;Action&#39; and &#39;Symbol&#39; columns to create a unique identifier for each transaction</span>
</span></span><span class="line"><span class="cl">    <span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;TradeDate_Action_Symbol_VIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;Trade_Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;, &#34;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;Action&#39;</span><span class="p">]</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;, &#34;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;Symbol&#39;</span><span class="p">]</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;, VIX = &#34;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">        <span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;Approx_VIX_Level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Split buys and sells and sum the notional amounts</span>
</span></span><span class="line"><span class="cl">    <span class="n">transactions_sells</span> <span class="o">=</span> <span class="n">transactions_data</span><span class="p">[</span><span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;Action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Sell to Close&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">transactions_sells</span> <span class="o">=</span> <span class="n">transactions_sells</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp_Date&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s1">&#39;Amount&#39;</span><span class="p">,</span> <span class="s1">&#39;Quantity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">transactions_buys</span> <span class="o">=</span> <span class="n">transactions_data</span><span class="p">[</span><span class="n">transactions_data</span><span class="p">[</span><span class="s1">&#39;Action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Buy to Open&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">transactions_buys</span> <span class="o">=</span> <span class="n">transactions_buys</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp_Date&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s1">&#39;Amount&#39;</span><span class="p">,</span> <span class="s1">&#39;Quantity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Merge buys and sells dataframes back together</span>
</span></span><span class="line"><span class="cl">    <span class="n">merged_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">transactions_buys</span><span class="p">,</span> <span class="n">transactions_sells</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp_Date&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_Buy&#39;</span><span class="p">,</span> <span class="s1">&#39;_Sell&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">merged_transactions</span> <span class="o">=</span> <span class="n">merged_transactions</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Exp_Date&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">merged_transactions</span> <span class="o">=</span> <span class="n">merged_transactions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Identify the closed positions</span>
</span></span><span class="line"><span class="cl">    <span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Closed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Amount_Sell&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Quantity_Buy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Quantity_Sell&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a new dataframe for closed positions</span>
</span></span><span class="line"><span class="cl">    <span class="n">closed_trades</span> <span class="o">=</span> <span class="n">merged_transactions</span><span class="p">[</span><span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Closed&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">closed_trades</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Realized_PnL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Sell&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Percent_PnL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Realized_PnL&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">closed_trades</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Closed&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp_Date&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Quantity_Sell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Quantity_Sell&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate the net % PnL</span>
</span></span><span class="line"><span class="cl">    <span class="n">net_PnL_percent</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Realized_PnL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">net_PnL_percent_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">net_PnL_percent</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">%&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate the net $ PnL</span>
</span></span><span class="line"><span class="cl">    <span class="n">net_PnL</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Realized_PnL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">net_PnL_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;$</span><span class="si">{</span><span class="n">net_PnL</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a new dataframe for open positions</span>
</span></span><span class="line"><span class="cl">    <span class="n">open_trades</span> <span class="o">=</span> <span class="n">merged_transactions</span><span class="p">[</span><span class="o">~</span><span class="n">merged_transactions</span><span class="p">[</span><span class="s1">&#39;Closed&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">open_trades</span> <span class="o">=</span> <span class="n">open_trades</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">open_trades</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Closed&#39;</span><span class="p">,</span> <span class="s1">&#39;Amount_Sell&#39;</span><span class="p">,</span> <span class="s1">&#39;Quantity_Sell&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp_Date&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate the total market value of opened positions</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># If start and end dates for trades and expirations are None, use only the closed positions</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">exp_start_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exp_end_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trade_start_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trade_end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">total_opened_pos_mkt_val</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">total_opened_pos_mkt_val</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">open_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Buy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">total_opened_pos_mkt_val_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;$</span><span class="si">{</span><span class="n">total_opened_pos_mkt_val</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate the total market value of closed positions</span>
</span></span><span class="line"><span class="cl">    <span class="n">total_closed_pos_mkt_val</span> <span class="o">=</span> <span class="n">closed_trades</span><span class="p">[</span><span class="s1">&#39;Amount_Sell&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">total_closed_pos_mkt_val_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;$</span><span class="si">{</span><span class="n">total_closed_pos_mkt_val</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">transactions_data</span><span class="p">,</span> <span class="n">closed_trades</span><span class="p">,</span> <span class="n">open_trades</span><span class="p">,</span> <span class="n">net_PnL_percent_str</span><span class="p">,</span> <span class="n">net_PnL_str</span><span class="p">,</span> <span class="n">total_opened_pos_mkt_val_str</span><span class="p">,</span> <span class="n">total_closed_pos_mkt_val_str</span>
</span></span></code></pre></div><h3 id="coinbase_fetch_available_products" class="relative group">coinbase_fetch_available_products <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#coinbase_fetch_available_products" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">coinbase_fetch_available_products</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_currency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">quote_currency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Fetch available products from Coinbase Exchange API.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_currency : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        Filter products by base currency (e.g., &#39;BTC&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    quote_currency : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        Filter products by quote currency (e.g., &#39;USD&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    status : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        Filter products by status (e.g., &#39;online&#39;, &#39;offline&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing available products with their details.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.exchange.coinbase.com/products&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">products</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Convert the list of products into a pandas DataFrame</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Filter by base_currency if provided</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">base_currency</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;base_currency&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">base_currency</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Filter by quote_currency if provided</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">quote_currency</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;quote_currency&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quote_currency</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Filter by status if provided</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">status</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Sort by &#34;id&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">errh</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;HTTP Error: </span><span class="si">{</span><span class="n">errh</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">errc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error Connecting: </span><span class="si">{</span><span class="n">errc</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">errt</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Timeout Error: </span><span class="si">{</span><span class="n">errt</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Oops: Something Else </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">coinbase_fetch_available_products</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">base_currency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">quote_currency</span><span class="o">=</span><span class="s2">&#34;USD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">status</span><span class="o">=</span><span class="s2">&#34;online&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No data returned.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="coinbase_fetch_full_history" class="relative group">coinbase_fetch_full_history <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#coinbase_fetch_full_history" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">coinbase_fetch_historical_candles</span> <span class="kn">import</span> <span class="n">coinbase_fetch_historical_candles</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">coinbase_fetch_full_history</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">product_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Fetch full historical data for a given product from Coinbase Exchange API.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    product_id : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The trading pair (e.g., &#39;BTC-USD&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    start : datetime
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start time in UTC.
</span></span></span><span class="line"><span class="cl"><span class="s2">    end : datetime
</span></span></span><span class="line"><span class="cl"><span class="s2">        End time in UTC.
</span></span></span><span class="line"><span class="cl"><span class="s2">    granularity : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Time slice in seconds (e.g., 3600 for hourly candles).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing time, low, high, open, close, volume.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_start</span> <span class="o">=</span> <span class="n">start</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">current_start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">granularity</span> <span class="o">*</span> <span class="mi">300</span><span class="p">),</span> <span class="n">end</span><span class="p">)</span>  <span class="c1"># Fetch max 300 candles per request</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">coinbase_fetch_historical_candles</span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span> <span class="n">current_start</span><span class="p">,</span> <span class="n">current_end</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_start</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">granularity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Small delay to respect rate limits</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">all_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">full_df</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">coinbase_fetch_full_history</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">product_id</span><span class="o">=</span><span class="s2">&#34;BTC-USD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">end</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">granularity</span><span class="o">=</span><span class="mi">86_400</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No data returned.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="coinbase_fetch_historical_candles" class="relative group">coinbase_fetch_historical_candles <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#coinbase_fetch_historical_candles" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">coinbase_fetch_historical_candles</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">product_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Fetch historical candle data for a given product from Coinbase Exchange API.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    product_id : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The trading pair (e.g., &#39;BTC-USD&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    start : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start time in UTC.
</span></span></span><span class="line"><span class="cl"><span class="s2">    end : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        End time in UTC.
</span></span></span><span class="line"><span class="cl"><span class="s2">    granularity : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Time slice in seconds (e.g., 60 for minute candles, 3600 for hourly candles, 86,400 for daily candles).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing time, low, high, open, close, volume.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://api.exchange.coinbase.com/products/</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s1">/candles&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="n">start</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="n">end</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;granularity&#39;</span><span class="p">:</span> <span class="n">granularity</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">    <span class="n">retry_delay</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># initial delay in seconds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Coinbase Exchange API returns data in reverse chronological order</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Convert to DataFrame</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">errh</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Rate limit exceeded. Retrying in </span><span class="si">{</span><span class="n">retry_delay</span><span class="si">}</span><span class="s2"> seconds...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">retry_delay</span> <span class="o">*=</span> <span class="mi">2</span>  <span class="c1"># Exponential backoff</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;HTTP Error: </span><span class="si">{</span><span class="n">errh</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">errc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error Connecting: </span><span class="si">{</span><span class="n">errc</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">retry_delay</span> <span class="o">*=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">errt</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Timeout Error: </span><span class="si">{</span><span class="n">errt</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">retry_delay</span> <span class="o">*=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;OOps: Something Else </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&#34;Failed to fetch data after multiple retries.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">coinbase_fetch_historical_candles</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">product_id</span><span class="o">=</span><span class="s2">&#34;BTC-USD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">end</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">granularity</span><span class="o">=</span><span class="mi">3_600</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No data returned.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="coinbase_pull_data" class="relative group">coinbase_pull_data <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#coinbase_pull_data" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">calendar</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">coinbase_fetch_available_products</span> <span class="kn">import</span> <span class="n">coinbase_fetch_available_products</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">coinbase_fetch_full_history</span> <span class="kn">import</span> <span class="n">coinbase_fetch_full_history</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get the data directory from the configuration</span>
</span></span><span class="line"><span class="cl"><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s2">&#34;DATA_DIR&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">coinbase_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_currency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">quote_currency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="c1"># 60=minute, 3600=hourly, 86400=daily</span>
</span></span><span class="line"><span class="cl">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="c1"># default status is &#39;online&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># default start date</span>
</span></span><span class="line"><span class="cl">    <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="c1"># updates data through 1 day ago due to lag in data availability</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Update existing record or pull full historical data for a given product from Coinbase Exchange API.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to store downloaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Nasdaq_Data_Link&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_currency : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The base currency (e.g., &#39;BTC&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    quote_currency : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The quote currency (e.g., &#39;USD&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    status : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        Filter products by status (default is &#39;online&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    granularity : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Time slice in seconds (e.g., 3600 for hourly candles).
</span></span></span><span class="line"><span class="cl"><span class="s2">    start_date : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start date in UTC (ISO format).
</span></span></span><span class="line"><span class="cl"><span class="s2">    end_date : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        End date in UTC (ISO format).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># List of crypto assets</span>
</span></span><span class="line"><span class="cl">    <span class="n">filtered_products</span> <span class="o">=</span> <span class="n">coinbase_fetch_available_products</span><span class="p">(</span><span class="n">base_currency</span><span class="o">=</span><span class="n">base_currency</span><span class="p">,</span> <span class="n">quote_currency</span><span class="o">=</span><span class="n">quote_currency</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">filtered_products_list</span> <span class="o">=</span> <span class="n">filtered_products</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">filtered_products_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filtered_products_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_products</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">filtered_products</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;base_currency&#39;</span><span class="p">,</span> <span class="s1">&#39;quote_currency&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">filtered_products_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_products_list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No products found with the specified base and/or quote currencies.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">missing_data</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">omitted_data</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_products</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_products_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Loop for updates</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">filtered_products_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Updating product </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">num_products</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">granularity</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">time_length</span> <span class="o">=</span> <span class="s2">&#34;Minute&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">granularity</span> <span class="o">==</span> <span class="mi">3600</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">time_length</span> <span class="o">=</span> <span class="s2">&#34;Hourly&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">granularity</span> <span class="o">==</span> <span class="mi">86400</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">time_length</span> <span class="o">=</span> <span class="s2">&#34;Daily&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Error - please confirm timeframe.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Set file location based on parameters</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_location</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">time_length</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.pkl&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Attempt to read existing pickle data file</span>
</span></span><span class="line"><span class="cl">            <span class="n">ex_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ex_data</span> <span class="o">=</span> <span class="n">ex_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;File found...updating the </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Existing data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ex_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Pull recent data</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">coinbase_fetch_full_history</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;New data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Combine existing data with recent data</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ex_data</span><span class="p">,</span><span class="n">new_data</span><span class="p">[</span><span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ex_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Combined data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Create directory</span>
</span></span><span class="line"><span class="cl">            <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">time_length</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">full_history_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">full_history_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Data update complete for </span><span class="si">{</span><span class="n">time_length</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;--------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Starting year for fetching initial data</span>
</span></span><span class="line"><span class="cl">            <span class="n">starting_year</span> <span class="o">=</span> <span class="mi">2025</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Print error</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;File not found...downloading the </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> data starting with </span><span class="si">{</span><span class="n">starting_year</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">def</span> <span class="nf">get_full_hist</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Define the start and end dates</span>
</span></span><span class="line"><span class="cl">                    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Default start date</span>
</span></span><span class="line"><span class="cl">                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Updates data through 1 day ago</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1"># Fetch and process the data</span>
</span></span><span class="line"><span class="cl">                    <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">coinbase_fetch_full_history</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;Date&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">                    <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1"># Iterate through rows to see if the value of the asset ever exceeds a specified threshold</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Default value for the price threshold is 0 USD</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># If the price never exceeds this threshold, the asset is omitted from the final list</span>
</span></span><span class="line"><span class="cl">                    <span class="k">def</span> <span class="nf">find_first_close_above_threshold</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># Ensure &#39;Date&#39; is the index before proceeding</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="s1">&#39;Date&#39;</span> <span class="ow">in</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">full_history_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">full_history_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        
</span></span><span class="line"><span class="cl">                        <span class="c1"># Iterate through the DataFrame</span>
</span></span><span class="line"><span class="cl">                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;First occurrence: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, close=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                                <span class="c1"># Return the filtered DataFrame starting from this row</span>
</span></span><span class="line"><span class="cl">                                <span class="k">return</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">                        
</span></span><span class="line"><span class="cl">                        <span class="c1"># If no value meets the condition, return an empty DataFrame</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Share price never exceeds </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> USD.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">omitted_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="n">full_history_above_threshold_df</span> <span class="o">=</span> <span class="n">find_first_close_above_threshold</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">full_history_above_threshold_df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;KeyError: No data available for </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">. Trying next year...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_year</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1"># Base case: Stop if the next year exceeds the current year</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">next_year</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No more data available for any future years.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">missing_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1"># Recursive call for the next year</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">get_full_hist</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">next_year</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Fetch the full history starting from the given year</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">get_full_hist</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">starting_year</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">full_history_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Create directory</span>
</span></span><span class="line"><span class="cl">                <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">time_length</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">full_history_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">full_history_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Initial data fetching completed successfully for </span><span class="si">{</span><span class="n">time_length</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;--------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No data could be fetched for the specified range.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove the cryptocurrencies with missing data from the final list</span>
</span></span><span class="line"><span class="cl">    <span class="n">missing_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">missing_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Data missing for: </span><span class="si">{</span><span class="n">missing_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">missing_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Removing </span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2"> from the list because it is missing data.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">filtered_products_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2"> not in list.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove the cryptocurrencies with share prices that never exceed 1 USD from the final list</span>
</span></span><span class="line"><span class="cl">    <span class="n">omitted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">omitted_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Data omitted due to price for: </span><span class="si">{</span><span class="n">omitted_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">omitted_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Removing </span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2"> from the list because the share price never exceeds 1 USD.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">filtered_products_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2"> not in list.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove stablecoins from the final list</span>
</span></span><span class="line"><span class="cl">    <span class="n">stablecoins_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;USDT-USD&#39;</span><span class="p">,</span> <span class="s1">&#39;USDC-USD&#39;</span><span class="p">,</span> <span class="s1">&#39;PAX-USD&#39;</span><span class="p">,</span> <span class="s1">&#39;DAI-USD&#39;</span><span class="p">,</span> <span class="s1">&#39;PYUSD-USD&#39;</span><span class="p">,</span> <span class="s1">&#39;GUSD-USD&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">stablecoins_to_remove</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">stablecoins_to_remove</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Data for stable coins not to be used: </span><span class="si">{</span><span class="n">stablecoins_to_remove</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">stablecoins_to_remove</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">filtered_products_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(f&#34;Removing {asset} from the list because it is a stablecoin.&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(f&#34;{asset} not in list.&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove the wrapped coins from the final list</span>
</span></span><span class="line"><span class="cl">    <span class="n">wrapped_coins_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WAXL-USD&#39;</span><span class="p">,</span> <span class="s1">&#39;WBTC-USD&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">wrapped_coins_to_remove</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wrapped_coins_to_remove</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Data for wrapped coins not to be used: </span><span class="si">{</span><span class="n">wrapped_coins_to_remove</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">wrapped_coins_to_remove</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">filtered_products_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(f&#34;Removing {asset} from the list because it is a wrapped coin.&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(f&#34;{asset} not in list.&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Print the final list of token and the length of the list</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Final list of tokens: </span><span class="si">{</span><span class="n">filtered_products_list</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Length of final list of tokens: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_products_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">full_history_df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">    <span class="c1"># Example usage to pull all data for each month from 2010 to 2024</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">granularity</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">86400</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2025</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Pulling data for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Get the last day of the month</span>
</span></span><span class="line"><span class="cl">                    <span class="n">last_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="n">coinbase_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Coinbase&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Cryptocurrencies&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">excel_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">base_currency</span><span class="o">=</span><span class="s2">&#34;BTC&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">quote_currency</span><span class="o">=</span><span class="s2">&#34;USD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">granularity</span><span class="o">=</span><span class="n">granularity</span><span class="p">,</span> <span class="c1"># 60=minute, 3600=hourly, 86400=daily</span>
</span></span><span class="line"><span class="cl">                        <span class="n">status</span><span class="o">=</span><span class="s1">&#39;online&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">last_day</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to pull data for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># current_year = datetime.now().year</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># current_month = datetime.now().month</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># current_day = datetime.now().day</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># # Crypto Data</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># currencies = [&#34;BTC&#34;, &#34;ETH&#34;, &#34;SOL&#34;, &#34;XRP&#34;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># # Iterate through each currency</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for cur in currencies:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     # Example usage - minute</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     coinbase_pull_data(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         base_directory=DATA_DIR,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         source=&#34;Coinbase&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         asset_class=&#34;Cryptocurrencies&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         excel_export=False,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         pickle_export=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         output_confirmation=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         base_currency=cur,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         quote_currency=&#34;USD&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         granularity=60, # 60=minute, 3600=hourly, 86400=daily</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         status=&#39;online&#39;, # default status is &#39;online&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         start_date=datetime(current_year, current_month - 1, 1), # default start date</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         end_date=datetime.now() - timedelta(days=1), # updates data through 1 day ago due to lag in data availability</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#     # Example usage - hourly</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     coinbase_pull_data(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         base_directory=DATA_DIR,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         source=&#34;Coinbase&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         asset_class=&#34;Cryptocurrencies&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         excel_export=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         pickle_export=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         output_confirmation=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         base_currency=cur,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         quote_currency=&#34;USD&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         granularity=3600, # 60=minute, 3600=hourly, 86400=daily</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         status=&#39;online&#39;, # default status is &#39;online&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         start_date=datetime(current_year, current_month - 1, 1), # default start date</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         end_date=datetime.now() - timedelta(days=1), # updates data through 1 day ago due to lag in data availability</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     )</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#     # Example usage - daily</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     coinbase_pull_data(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         base_directory=DATA_DIR,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         source=&#34;Coinbase&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         asset_class=&#34;Cryptocurrencies&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         excel_export=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         pickle_export=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         output_confirmation=True,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         base_currency=cur,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         quote_currency=&#34;USD&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         granularity=86400, # 60=minute, 3600=hourly, 86400=daily</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         status=&#39;online&#39;, # default status is &#39;online&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         start_date=datetime(current_year, current_month - 1, 1), # default start date</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         end_date=datetime.now() - timedelta(days=1), # updates data through 1 day ago due to lag in data availability</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     )</span>
</span></span></code></pre></div><h3 id="df_info" class="relative group">df_info <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#df_info" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">df_info</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Display summary information about a pandas DataFrame.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function prints:
</span></span></span><span class="line"><span class="cl"><span class="s2">    - The DataFrame&#39;s column names, shape, and data types via `df.info()`
</span></span></span><span class="line"><span class="cl"><span class="s2">    - The first 5 rows using `df.head()`
</span></span></span><span class="line"><span class="cl"><span class="s2">    - The last 5 rows using `df.tail()`
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    It uses `display()` for better output formatting in environments like Jupyter notebooks.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The DataFrame to inspect.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; df_info(my_dataframe)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The columns, shape, and data types are:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The first 5 rows are:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The last 5 rows are:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</span></span></code></pre></div><h3 id="df_info_markdown" class="relative group">df_info_markdown <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#df_info_markdown" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">df_info_markdown</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Generate a Markdown-formatted summary of a pandas DataFrame.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function captures and formats the output of `df.info()`, `df.head()`, 
</span></span></span><span class="line"><span class="cl"><span class="s2">    and `df.tail()` in Markdown for easy inclusion in reports, documentation, 
</span></span></span><span class="line"><span class="cl"><span class="s2">    or web-based rendering (e.g., Hugo or Jupyter export workflows).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The DataFrame to summarize.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    str
</span></span></span><span class="line"><span class="cl"><span class="s2">        A string containing the DataFrame&#39;s info, head, and tail 
</span></span></span><span class="line"><span class="cl"><span class="s2">        formatted in Markdown.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; print(df_info_markdown(df))
</span></span></span><span class="line"><span class="cl"><span class="s2">    ```text
</span></span></span><span class="line"><span class="cl"><span class="s2">    The columns, shape, and data types are:
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;output from df.info()&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    ```
</span></span></span><span class="line"><span class="cl"><span class="s2">    The first 5 rows are:
</span></span></span><span class="line"><span class="cl"><span class="s2">    |   | col1 | col2 |
</span></span></span><span class="line"><span class="cl"><span class="s2">    |---|------|------|
</span></span></span><span class="line"><span class="cl"><span class="s2">    | 0 | ...  | ...  |
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    The last 5 rows are:
</span></span></span><span class="line"><span class="cl"><span class="s2">    ...
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Capture df.info() output</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">buf</span><span class="o">=</span><span class="n">buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">info_str</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert head and tail to Markdown</span>
</span></span><span class="line"><span class="cl">    <span class="n">head_str</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">floatfmt</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tail_str</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">floatfmt</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">markdown</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;```text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;The columns, shape, and data types are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">info_str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;```&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">The first 5 rows are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">head_str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">The last 5 rows are:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tail_str</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="export_track_md_deps" class="relative group">export_track_md_deps <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#export_track_md_deps" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">export_track_md_deps</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dep_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">md_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Export Markdown content to a file and track it as a dependency.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function writes the provided content to the specified Markdown file and 
</span></span></span><span class="line"><span class="cl"><span class="s2">    appends the filename to the given dependency file (typically `index_dep.txt`).
</span></span></span><span class="line"><span class="cl"><span class="s2">    This is useful in workflows where Markdown fragments are later assembled 
</span></span></span><span class="line"><span class="cl"><span class="s2">    into a larger document (e.g., a Hugo `index.md`).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    dep_file : Path
</span></span></span><span class="line"><span class="cl"><span class="s2">        Path to the dependency file that tracks Markdown fragment filenames.
</span></span></span><span class="line"><span class="cl"><span class="s2">    md_filename : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The name of the Markdown file to export.
</span></span></span><span class="line"><span class="cl"><span class="s2">    content : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The Markdown-formatted content to write to the file.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; export_track_md_deps(Path(&#34;index_dep.txt&#34;), &#34;01_intro.md&#34;, &#34;# Introduction</span><span class="se">\n</span><span class="s2">...&#34;)
</span></span></span><span class="line"><span class="cl"><span class="s2">     Exported and tracked: 01_intro.md
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">Path</span><span class="p">(</span><span class="n">md_filename</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">dep_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">md_filename</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34; Exported and tracked: </span><span class="si">{</span><span class="n">md_filename</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="load_api_keys" class="relative group">load_api_keys <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#load_api_keys" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get the environment variable file path from the configuration</span>
</span></span><span class="line"><span class="cl"><span class="n">ENV_PATH</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s2">&#34;ENV_PATH&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_api_keys</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">env_path</span><span class="p">:</span> <span class="n">Path</span><span class="o">=</span><span class="n">ENV_PATH</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Load API keys from a .env file.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    env_path : Path
</span></span></span><span class="line"><span class="cl"><span class="s2">        Path to the .env file. Default is the ENV_PATH from settings.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    keys : dict
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dictionary of API keys.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">load_dotenv</span><span class="p">(</span><span class="n">dotenv_path</span><span class="o">=</span><span class="n">env_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;INFURA_KEY&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;INFURA_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;NASDAQ_DATA_LINK_KEY&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;NASDAQ_DATA_LINK_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;COINBASE_KEY&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;COINBASE_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;COINBASE_SECRET&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;COINBASE_SECRET&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_APP_KEY&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_APP_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_SECRET&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_SECRET&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_ACCOUNT_NUMBER_1&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_ACCOUNT_NUMBER_1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_ENCRYPTED_ACCOUNT_ID_1&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_ENCRYPTED_ACCOUNT_ID_1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_ACCOUNT_NUMBER_2&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_ACCOUNT_NUMBER_2&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_ENCRYPTED_ACCOUNT_ID_2&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_ENCRYPTED_ACCOUNT_ID_2&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_ACCOUNT_NUMBER_3&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_ACCOUNT_NUMBER_3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;SCHWAB_ENCRYPTED_ACCOUNT_ID_3&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;SCHWAB_ENCRYPTED_ACCOUNT_ID_3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;POLYGON_KEY&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;POLYGON_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Raise error if any key is missing</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Missing environment variable: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">keys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_keys</span> <span class="o">=</span> <span class="n">load_api_keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;API keys loaded successfully.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="load_data" class="relative group">load_data <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#load_data" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timeframe</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Load data from a CSV, Excel, or Pickle file into a pandas DataFrame.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This function attempts to read a file first as a CSV, then as an Excel file 
</span></span></span><span class="line"><span class="cl"><span class="s2">    (specifically looking for a sheet named &#39;data&#39; and using the &#39;calamine&#39; engine).
</span></span></span><span class="line"><span class="cl"><span class="s2">    If both attempts fail, a ValueError is raised.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to read data file.
</span></span></span><span class="line"><span class="cl"><span class="s2">    ticker : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Ticker symbol to read.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Yahoo&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    timeframe : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Timeframe for the data (e.g., &#39;Daily&#39;, &#39;Month_End&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    file_format : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Format of the file to load (&#39;csv&#39;, &#39;excel&#39;, or &#39;pickle&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The loaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Raises:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    ValueError
</span></span></span><span class="line"><span class="cl"><span class="s2">        If the file could not be loaded as either CSV or Excel.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; df = load_data(DATA_DIR, &#34;^VIX&#34;, &#34;Yahoo_Finance&#34;, &#34;Indices&#34;)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&#34;csv&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">csv_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.csv&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&#34;excel&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">xlsx_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.xlsx&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xlsx_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&#34;calamine&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&#34;pickle&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pickle_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">source</span> <span class="o">/</span> <span class="n">asset_class</span> <span class="o">/</span> <span class="n">timeframe</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.pkl&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34; Unsupported file format: </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">. Please use &#39;csv&#39;, &#39;excel&#39;, or &#39;pickle&#39;.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="pandas_set_decimal_places" class="relative group">pandas_set_decimal_places <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#pandas_set_decimal_places" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pandas_set_decimal_places</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Set the number of decimal places displayed for floating-point numbers in pandas.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    decimal_places : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        The number of decimal places to display for float values in pandas DataFrames and Series.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Example:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; dp(3)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &gt;&gt;&gt; pd.DataFrame([1.23456789])
</span></span></span><span class="line"><span class="cl"><span class="s2">           0
</span></span></span><span class="line"><span class="cl"><span class="s2">    0   1.235
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float_format&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;%.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="plot_timeseries" class="relative group">plot_timeseries <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plot_timeseries" aria-label="Anchor">#</a></span></h3><!-- INSERT_plot_timeseries_HERE -->
<h3 id="plot_stats" class="relative group">plot_stats <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plot_stats" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">stats_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot_columns</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_rotation</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_tick_spacing</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_tick_spacing</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">grid</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">export_plot</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Plot the price data from a DataFrame for a specified date range and columns.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    stats_df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing the price data to plot.
</span></span></span><span class="line"><span class="cl"><span class="s2">    plot_columns : str OR list
</span></span></span><span class="line"><span class="cl"><span class="s2">        List of columns to plot from the DataFrame. If none, all columns will be plotted.
</span></span></span><span class="line"><span class="cl"><span class="s2">    title : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Title of the plot.
</span></span></span><span class="line"><span class="cl"><span class="s2">    x_label : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Label for the x-axis.
</span></span></span><span class="line"><span class="cl"><span class="s2">    x_rotation : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Rotation angle for the x-axis date labels.
</span></span></span><span class="line"><span class="cl"><span class="s2">    x_tick_spacing : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Spacing for the x-axis ticks.
</span></span></span><span class="line"><span class="cl"><span class="s2">    y_label : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Label for the y-axis.
</span></span></span><span class="line"><span class="cl"><span class="s2">    y_tick_spacing : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Spacing for the y-axis ticks.
</span></span></span><span class="line"><span class="cl"><span class="s2">    grid : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        Whether to display a grid on the plot.
</span></span></span><span class="line"><span class="cl"><span class="s2">    legend : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        Whether to display a legend on the plot.
</span></span></span><span class="line"><span class="cl"><span class="s2">    export_plot : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        Whether to save the figure as a PNG file.
</span></span></span><span class="line"><span class="cl"><span class="s2">    plot_file_name : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        File name for saving the figure (if save_fig is True).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set plot figure size and background color</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&#34;#F5F5F5&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plot data</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">plot_columns</span> <span class="o">==</span> <span class="s2">&#34;All&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stats_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">stats_df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">plot_columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">stats_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">stats_df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Format X axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">x_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">x_rotation</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Format Y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">y_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Format title, layout, grid, and legend</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">grid</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save figure and display plot</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">export_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plot_file_name</span><span class="si">}</span><span class="s2">.png&#34;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&#34;tight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Display the plot</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">None</span>
</span></span></code></pre></div><h3 id="plot_vix_with_trades" class="relative group">plot_vix_with_trades <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plot_vix_with_trades" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_vix_with_trades</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">vix_price_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">trades_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot_start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot_end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_tick_spacing</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_tick_spacing</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">export_plot</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Plot the VIX daily high and low prices, along with the VIX spikes, and trades.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    vix_price_df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dataframe containing the VIX price data to plot.
</span></span></span><span class="line"><span class="cl"><span class="s2">    trades_df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dataframe containing the trades data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    plot_start_date : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start date for the plot in &#39;YYYY-MM-DD&#39; format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    plot_end_date : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        End date for the plot in &#39;YYYY-MM-DD&#39; format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    index_number : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Index number to be used in the file name of the plot export.
</span></span></span><span class="line"><span class="cl"><span class="s2">    export_plot : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        Whether to save the figure as a PNG file.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    vix_data : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dataframe containing the VIX price data for the specified timeframe.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create temporary dataframe for the specified date range</span>
</span></span><span class="line"><span class="cl">    <span class="n">vix_data</span> <span class="o">=</span> <span class="n">vix_price_df</span><span class="p">[(</span><span class="n">vix_price_df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">plot_start_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vix_price_df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">plot_end_date</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set plot figure size and background color</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&#34;#F5F5F5&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plot VIX high and low price data</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vix_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vix_data</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vix_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vix_data</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plot VIX spikes</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">vix_data</span><span class="p">[</span><span class="n">vix_data</span><span class="p">[</span><span class="s1">&#39;Spike_SMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">vix_data</span><span class="p">[</span><span class="n">vix_data</span><span class="p">[</span><span class="s1">&#39;Spike_SMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">][</span><span class="s1">&#39;High&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spike (High &gt; 1.25 * 10 Day High SMA)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Plot trades</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">trades_df</span><span class="p">[</span><span class="s1">&#39;Trade_Date&#39;</span><span class="p">],</span> <span class="n">trades_df</span><span class="p">[</span><span class="s1">&#39;Approx_VIX_Level&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trades&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Annotate each point in trades_df with the corresponding Action_Symbol</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">trades_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Trade_Date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Approx_VIX_Level&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;TradeDate_Action_Symbol_VIX&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Format X axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DayLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">x_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Date&#34;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Format Y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">y_tick_spacing</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;VIX&#34;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Format title, layout, grid, and legend</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;CBOE Volatility Index (VIX), VIX Spikes, Trades, </span><span class="si">{</span><span class="n">plot_start_date</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">plot_end_date</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save figure and display plot</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">export_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># plt.savefig(f&#34;{index_number}_VIX_Spike_Trades_{plot_start_date}_{plot_end_date}.png&#34;, dpi=300, bbox_inches=&#34;tight&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">index_number</span><span class="si">}</span><span class="s2">_VIX_Spike_Trades.png&#34;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&#34;tight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Display the plot</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">vix_data</span>
</span></span></code></pre></div><h3 id="polygon_fetch_full_history" class="relative group">polygon_fetch_full_history <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#polygon_fetch_full_history" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">load_api_keys</span> <span class="kn">import</span> <span class="n">load_api_keys</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">polygon</span> <span class="kn">import</span> <span class="n">RESTClient</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load API keys from the environment</span>
</span></span><span class="line"><span class="cl"><span class="n">api_keys</span> <span class="o">=</span> <span class="n">load_api_keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get the environment variable for where data is stored</span>
</span></span><span class="line"><span class="cl"><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s2">&#34;DATA_DIR&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">polygon_fetch_full_history</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timespan</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">multiplier</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">adjusted</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">existing_history_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_start</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">free_tier</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Fetch full historical data for a given product from Polygon API.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    client
</span></span></span><span class="line"><span class="cl"><span class="s2">        Polygon API client instance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    ticker : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Ticker symbol to download.
</span></span></span><span class="line"><span class="cl"><span class="s2">    timespan : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Time span for the data (e.g., &#34;minute&#34;, &#34;hour&#34;, &#34;day&#34;, &#34;week&#34;, &#34;month&#34;, &#34;quarter&#34;, &#34;year&#34;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    multiplier : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Multiplier for the time span (e.g., 1 for daily data).
</span></span></span><span class="line"><span class="cl"><span class="s2">    adjusted : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, return adjusted data; if False, return raw data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    full_history_df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing the data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    current_start : datetime
</span></span></span><span class="line"><span class="cl"><span class="s2">        Date for which to start pulling data in datetime format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    free_tier : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, then pause to avoid API limits.
</span></span></span><span class="line"><span class="cl"><span class="s2">    verbose : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print detailed information about the data being processed.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    full_history_df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing the data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Copy DataFrame</span>
</span></span><span class="line"><span class="cl">    <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">existing_history_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">timespan</span> <span class="o">==</span> <span class="s2">&#34;minute&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_delta</span> <span class="o">=</span> <span class="mi">15</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_overlap</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">timespan</span> <span class="o">==</span> <span class="s2">&#34;hour&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_delta</span> <span class="o">=</span> <span class="mi">15</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_overlap</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">timespan</span> <span class="o">==</span> <span class="s2">&#34;day&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_delta</span> <span class="o">=</span> <span class="mi">180</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_overlap</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Invalid </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">new_data_last_date</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_date_last_date_check</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">current_start</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Offset end date by time_delta</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_end</span> <span class="o">=</span> <span class="n">current_start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">time_delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Pulling </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data for </span><span class="si">{</span><span class="n">current_start</span><span class="si">}</span><span class="s2"> thru </span><span class="si">{</span><span class="n">current_end</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">...</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Pull new data</span>
</span></span><span class="line"><span class="cl">            <span class="n">aggs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_aggs</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">timespan</span><span class="o">=</span><span class="n">timespan</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">multiplier</span><span class="o">=</span><span class="n">multiplier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">from_</span><span class="o">=</span><span class="n">current_start</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">to</span><span class="o">=</span><span class="n">current_end</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">adjusted</span><span class="o">=</span><span class="n">adjusted</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">sort</span><span class="o">=</span><span class="s2">&#34;asc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">limit</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># if len(aggs) == 0:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># raise Exception(f&#34;No data is available for {ticker} for {current_start} thru {current_end}. Please attempt different dates.&#34;)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Convert to DataFrame</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">bar</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">aggs</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span><span class="p">[</span><span class="s2">&#34;timestamp&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="s2">&#34;timestamp&#34;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&#34;ms&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;vwap&#39;</span><span class="p">,</span> <span class="s1">&#39;transactions&#39;</span><span class="p">,</span> <span class="s1">&#39;otc&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Enforce dtypes to match full_history_df</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">full_history_df</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># (Optional) reorder columns to match schema</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># new_data = new_data[full_history_df.columns]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Find last date in new_data</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data_last_date</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;New data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># No longer necessary to check for 5000 rows of data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if new data contains 5000 rows</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># if len(new_data) == 5000:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># raise Exception(f&#34;New data for {ticker} contains 5000 rows, indicating potential issues with data completeness or API limits.&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># If full_history_df length is not 0, check to confirm that data overlaps to verify that there were not any splits in the data</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># if not full_history_df.empty:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># if not full_history_df[&#39;Date&#39;].isin(new_data[&#39;Date&#39;]).any():</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># raise Exception(f&#34;New data does not overlap with existing data.&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Columns present in both frames</span>
</span></span><span class="line"><span class="cl">                <span class="n">common_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">full_history_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">new_data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">common_cols</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&#34;No common columns to compare.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># (Optional) de-duplicate to speed up the merge</span>
</span></span><span class="line"><span class="cl">                <span class="n">full_dedup</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="p">[</span><span class="n">common_cols</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_dedup</span>  <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="n">common_cols</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Inner join on every shared column = exact row matches</span>
</span></span><span class="line"><span class="cl">                <span class="n">overlap</span> <span class="o">=</span> <span class="n">full_dedup</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">new_dedup</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">common_cols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">overlap</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;New data does not overlap with existing data (full-row check).&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Combine existing data with recent data, drop duplicates, sort values, reset index</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">full_history_df</span><span class="p">,</span> <span class="n">new_data</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&#34;Date&#34;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&#34;last&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">full_history_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Combined data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;No data is available for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">current_start</span><span class="si">}</span><span class="s2"> thru </span><span class="si">{</span><span class="n">current_end</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">user_choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;Press Enter to continue, or type &#39;q&#39; to quit: &#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">user_choice</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;q&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Aborting operation to update </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>  <span class="c1"># break out of the while loop</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Trying next timeframe for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Set last_data_date to current_end because we know data was not available</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># up until current_end</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_data_last_date</span> <span class="o">=</span> <span class="n">current_end</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to pull </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data for </span><span class="si">{</span><span class="n">current_start</span><span class="si">}</span><span class="s2"> thru </span><span class="si">{</span><span class="n">current_end</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span>  <span class="c1"># Re-raise the original exception</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Break out of loop if data is up-to-date (or close to being up-to-date because it is </span>
</span></span><span class="line"><span class="cl">        <span class="c1"># possible that entire range was not pulled due to the way API handles hour data</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># from minute data)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">current_end</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Edge case, if the last date for new_date is exactly time_overlap&#39;s duration</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># past current_start</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">new_date_last_date_check</span> <span class="o">==</span> <span class="n">new_data_last_date</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">current_start</span> <span class="o">=</span> <span class="n">current_end</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">time_overlap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_date_last_date_check</span> <span class="o">=</span> <span class="n">new_data_last_date</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">current_start</span> <span class="o">=</span> <span class="n">new_data_last_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">time_overlap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">new_date_last_date_check</span> <span class="o">=</span> <span class="n">new_data_last_date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Code below is likely not necessary</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># # Overlap with existing data to capture all data but check to see if</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># # current_end is a Sunday and if so ensure overlap covers a trading day</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># if current_end.weekday() == 6:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#     current_start = last_data_date - timedelta(days=(time_overlap+1))</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># else:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#     current_start = last_data_date - timedelta(days=time_overlap)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for free tier and if so then pause for 12 seconds to avoid hitting API rate limits</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">free_tier</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Sleeping for 12 seconds to avoid hitting API rate limits...</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Return the DataFrame containing the full history</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">full_history_df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_month</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">day</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Open client connection</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span> <span class="o">=</span> <span class="n">RESTClient</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_keys</span><span class="p">[</span><span class="s2">&#34;POLYGON_KEY&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create an empty DataFrame</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;datetime64[ns]&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;vwap&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;transactions&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;int64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;otc&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;object&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Example usage - minute</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">polygon_fetch_full_history</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">ticker</span><span class="o">=</span><span class="s2">&#34;SPY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">timespan</span><span class="o">=</span><span class="s2">&#34;day&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">existing_history_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_start</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">current_year</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_month</span><span class="p">,</span> <span class="n">current_day</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">free_tier</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></div><h3 id="polygon_pull_data" class="relative group">polygon_pull_data <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#polygon_pull_data" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">load_api_keys</span> <span class="kn">import</span> <span class="n">load_api_keys</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">polygon</span> <span class="kn">import</span> <span class="n">RESTClient</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">polygon_fetch_full_history</span> <span class="kn">import</span> <span class="n">polygon_fetch_full_history</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load API keys from the environment</span>
</span></span><span class="line"><span class="cl"><span class="n">api_keys</span> <span class="o">=</span> <span class="n">load_api_keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get the environment variable for where data is stored</span>
</span></span><span class="line"><span class="cl"><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s2">&#34;DATA_DIR&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">polygon_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">timespan</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">multiplier</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">adjusted</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">force_existing_check</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">free_tier</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Read existing data file, download price data from Polygon, and export data.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory : any
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to store downloaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    ticker : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Ticker symbol to download.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Polygon&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    start_date : datetime
</span></span></span><span class="line"><span class="cl"><span class="s2">        Start date for the data in datetime format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    timespan : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Time span for the data (e.g., &#34;minute&#34;, &#34;hour&#34;, &#34;day&#34;, &#34;week&#34;, &#34;month&#34;, &#34;quarter&#34;, &#34;year&#34;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    multiplier : int
</span></span></span><span class="line"><span class="cl"><span class="s2">        Multiplier for the time span (e.g., 1 for daily data).
</span></span></span><span class="line"><span class="cl"><span class="s2">    adjusted : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, return adjusted data; if False, return raw data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    force_existing_check : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, force a complete check of the existing data file to verify that there are not any gaps in the data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    free_tier : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, then pause to avoid API limits.
</span></span></span><span class="line"><span class="cl"><span class="s2">    verbose : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print detailed information about the data being processed.
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    None
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Open client connection</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span> <span class="o">=</span> <span class="n">RESTClient</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_keys</span><span class="p">[</span><span class="s2">&#34;POLYGON_KEY&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set file location based on parameters</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_location</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.pkl&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">timespan</span> <span class="o">==</span> <span class="s2">&#34;minute&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_delta</span> <span class="o">=</span> <span class="mi">15</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_overlap</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">timespan</span> <span class="o">==</span> <span class="s2">&#34;hour&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_delta</span> <span class="o">=</span> <span class="mi">15</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_overlap</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">timespan</span> <span class="o">==</span> <span class="s2">&#34;day&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_delta</span> <span class="o">=</span> <span class="mi">180</span>
</span></span><span class="line"><span class="cl">        <span class="n">time_overlap</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Invalid </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Attempt to read existing pickle data file</span>
</span></span><span class="line"><span class="cl">        <span class="n">existing_history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Reset index if &#39;Date&#39; is column is the index</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;Date&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_history_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">existing_history_df</span> <span class="o">=</span> <span class="n">existing_history_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;File found...updating the </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span><span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Existing data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">existing_history_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Find last date in existing data</span>
</span></span><span class="line"><span class="cl">        <span class="n">last_data_date</span> <span class="o">=</span> <span class="n">existing_history_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Last date in existing data: </span><span class="si">{</span><span class="n">last_data_date</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">starting_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_history_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Number of rows in existing data: </span><span class="si">{</span><span class="n">starting_rows</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Overlap with existing data to capture all data</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_start</span> <span class="o">=</span> <span class="n">last_data_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">time_overlap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Print error</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;File not found...downloading the </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Create an empty DataFrame</span>
</span></span><span class="line"><span class="cl">        <span class="n">existing_history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;datetime64[ns]&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;vwap&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;float64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;transactions&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;int64&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;otc&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;object&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Set current date to start date</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_start</span> <span class="o">=</span> <span class="n">start_date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Check for force_existing_check flag</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">force_existing_check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Forcing check of existing data...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_start</span> <span class="o">=</span> <span class="n">start_date</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">full_history_df</span> <span class="o">=</span> <span class="n">polygon_fetch_full_history</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">timespan</span><span class="o">=</span><span class="n">timespan</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">multiplier</span><span class="o">=</span><span class="n">multiplier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">adjusted</span><span class="o">=</span><span class="n">adjusted</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">existing_history_df</span><span class="o">=</span><span class="n">existing_history_df</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_start</span><span class="o">=</span><span class="n">current_start</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">free_tier</span><span class="o">=</span><span class="n">free_tier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create directory</span>
</span></span><span class="line"><span class="cl">    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to Excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Exporting </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data to Excel...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">full_history_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to Pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Exporting </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data to Pickle...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">full_history_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The first and last date of </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> is: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">full_history_df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Number of rows after data update: </span><span class="si">{</span><span class="n">total_rows</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">starting_rows</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Number of rows added during update: </span><span class="si">{</span><span class="n">total_rows</span> <span class="o">-</span> <span class="n">starting_rows</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Polygon data complete for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timespan</span><span class="si">}</span><span class="s2"> data.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;--------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">full_history_df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_month</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">day</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Stock Data</span>
</span></span><span class="line"><span class="cl">    <span class="n">equities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;AMZN&#34;</span><span class="p">,</span> <span class="s2">&#34;AAPL&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Iterate through each stock</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">equities</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Example usage - minute</span>
</span></span><span class="line"><span class="cl">        <span class="n">polygon_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">ticker</span><span class="o">=</span><span class="n">stock</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Polygon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Equities&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">current_year</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_month</span><span class="p">,</span> <span class="n">current_day</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">timespan</span><span class="o">=</span><span class="s2">&#34;minute&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">force_existing_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">free_tier</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Example usage - hourly</span>
</span></span><span class="line"><span class="cl">        <span class="n">polygon_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">ticker</span><span class="o">=</span><span class="n">stock</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Polygon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Equities&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">current_year</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_month</span><span class="p">,</span> <span class="n">current_day</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">timespan</span><span class="o">=</span><span class="s2">&#34;hour&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">force_existing_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">free_tier</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Example usage - daily</span>
</span></span><span class="line"><span class="cl">        <span class="n">polygon_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">base_directory</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">ticker</span><span class="o">=</span><span class="n">stock</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">source</span><span class="o">=</span><span class="s2">&#34;Polygon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">asset_class</span><span class="o">=</span><span class="s2">&#34;Equities&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">current_year</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_month</span><span class="p">,</span> <span class="n">current_day</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">timespan</span><span class="o">=</span><span class="s2">&#34;day&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">force_existing_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">free_tier</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">excel_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pickle_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">output_confirmation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="strategy_harry_brown_perm_port" class="relative group">strategy_harry_brown_perm_port <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#strategy_harry_brown_perm_port" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">strategy_harry_brown_perm_port</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">starting_cash</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">cash_contrib</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">close_prices_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_day</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_per_high</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rebal_per_low</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Execute the re-balance strategy based on specified criteria.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    fund_list (str):
</span></span></span><span class="line"><span class="cl"><span class="s2">        List of funds for data to be combined from. Funds are strings in the form &#34;BTC-USD&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    starting_cash (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Starting investment balance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    cash_contrib (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Cash contribution to be made daily.
</span></span></span><span class="line"><span class="cl"><span class="s2">    close_prices_df (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing date and close prices for all funds to be included.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_month (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Month for annual rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_day (int):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Day for annual rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_per_high (float):
</span></span></span><span class="line"><span class="cl"><span class="s2">        High percentage for rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    rebal_per_low (float):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Low percentage for rebalance.
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing strategy data for all funds to be included. Also dumps the df to excel for reference later.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">num_funds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">close_prices_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Date to be used for annual rebalance</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_month</span> <span class="o">=</span> <span class="n">rebal_month</span>
</span></span><span class="line"><span class="cl">    <span class="n">target_day</span> <span class="o">=</span> <span class="n">rebal_day</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a dataframe with dates from the specific month</span>
</span></span><span class="line"><span class="cl">    <span class="n">rebal_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">target_month</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Specify the date or the next closest</span>
</span></span><span class="line"><span class="cl">    <span class="n">rebal_date</span> <span class="o">=</span> <span class="n">rebal_date</span><span class="p">[</span><span class="n">rebal_date</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">&gt;=</span> <span class="n">target_day</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Group by year and take the first entry for each year</span>
</span></span><span class="line"><span class="cl">    <span class="n">rebal_dates_by_year</span> <span class="o">=</span> <span class="n">rebal_date</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">rebal_date</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    Column order for the dataframe:
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_BA_Shares&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_BA_$_Invested&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_BA_Port_%&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Total_BA_$_Invested&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Contribution&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Rebalance&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_AA_Shares&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_AA_$_Invested&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[fund + &#34;_AA_Port_%&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    df[&#39;Total_AA_$_Invested&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate the columns and initial values for before action (BA) shares, $ invested, and port %</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span> <span class="o">/</span> <span class="n">num_funds</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set column values initially</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total_BA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Contribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cash_contrib</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Rebalance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;No&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set columns and values initially for after action (AA) shares, $ invested, and port %</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span> <span class="o">/</span> <span class="n">num_funds</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Set column value for after action (AA) total $ invested</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_cash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Iterate through the dataframe and execute the strategy</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Ensure there&#39;s a previous row to reference by checking the index value</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Initialize variable</span>
</span></span><span class="line"><span class="cl">            <span class="n">Total_BA_Invested</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate before action (BA) shares and $ invested values</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Shares&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Sum the asset values to find the total</span>
</span></span><span class="line"><span class="cl">                <span class="n">Total_BA_Invested</span> <span class="o">=</span> <span class="n">Total_BA_Invested</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate before action (BA) port % values</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Total_BA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Set column for before action (BA) total $ invested</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Total_BA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Total_BA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Initialize variables</span>
</span></span><span class="line"><span class="cl">            <span class="n">rebalance</span> <span class="o">=</span> <span class="s2">&#34;No&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check for a specific date annually</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Simple if statement to check if date_to_check is in jan_28_or_after_each_year</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">rebal_dates_by_year</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rebalance</span> <span class="o">=</span> <span class="s2">&#34;Yes&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check to see if any asset has portfolio percentage of greater than 35% or less than 15% and if so set variable</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rebal_per_high</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_Port_%&#34;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rebal_per_low</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">rebalance</span> <span class="o">=</span> <span class="s2">&#34;Yes&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># If rebalance is required, rebalance back to 25% for each asset, else just divide contribution evenly across assets</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">rebalance</span> <span class="o">==</span> <span class="s2">&#34;Yes&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Rebalance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebalance</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Total_BA_Invested</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Contribution&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Rebalance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebalance</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_BA_$_Invested&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Contribution&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Initialize variable</span>
</span></span><span class="line"><span class="cl">            <span class="n">Total_AA_Invested</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Set column values for after action (AA) shares and port %</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Shares&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_Close&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Sum the asset values to find the total</span>
</span></span><span class="line"><span class="cl">                <span class="n">Total_AA_Invested</span> <span class="o">=</span> <span class="n">Total_AA_Invested</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate after action (AA) port % values</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_Port_%&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">fund</span> <span class="o">+</span> <span class="s2">&#34;_AA_$_Invested&#34;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Total_AA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Set column for after action (AA) total $ invested</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Total_AA_Invested</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># If this is the first row</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Total_AA_$_Invested&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cumulative_Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plan_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Strategy.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Strategy.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Strategy complete for </span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span></code></pre></div><h3 id="summary_stats" class="relative group">summary_stats <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#summary_stats" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">summary_stats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">fund_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">use_calendar_days</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Calculate summary statistics for the given fund list and return data.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    fund_list (str):
</span></span></span><span class="line"><span class="cl"><span class="s2">        List of funds. This is used below in the excel/pickle export but not in the analysis.. Funds are strings in the form &#34;BTC-USD&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    df (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Dataframe with return data. Assumes returns are in decimal format (e.g., 0.05 for 5%), and assumes there is only 1 column.
</span></span></span><span class="line"><span class="cl"><span class="s2">    period (str):
</span></span></span><span class="line"><span class="cl"><span class="s2">        Period for which to calculate statistics. Options are &#34;Monthly&#34;, &#34;Weekly&#34;, &#34;Daily&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    use_calendar_days (bool):
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, use calendar days for calculations. If False, use trading days.
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df_stats (pd.DataFrame):
</span></span></span><span class="line"><span class="cl"><span class="s2">        pd.DataFrame: DataFrame containing various portfolio statistics.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Get the period in proper format</span>
</span></span><span class="line"><span class="cl">    <span class="n">period</span> <span class="o">=</span> <span class="n">period</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Map base timeframes</span>
</span></span><span class="line"><span class="cl">    <span class="n">period_to_timeframe</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Monthly&#34;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Weekly&#34;</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Daily&#34;</span><span class="p">:</span> <span class="mi">365</span> <span class="k">if</span> <span class="n">use_calendar_days</span> <span class="k">else</span> <span class="mi">252</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">timeframe</span> <span class="o">=</span> <span class="n">period_to_timeframe</span><span class="p">[</span><span class="n">period</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Invalid period: </span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">. Must be one of </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">period_to_timeframe</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeframe</span><span class="p">)</span> <span class="c1"># annualized</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Annualized Mean&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">timeframe</span><span class="p">)</span> <span class="c1"># annualized</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Sharpe Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Mean&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Annualized Volatility&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_cagr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cagr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_cagr</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_cagr</span><span class="p">)</span> <span class="o">/</span> <span class="n">timeframe</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;CAGR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cagr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1"> Max Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1"> Max Return (Date)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1"> Min Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1"> Min Return (Date)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">wealth_index</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">previous_peaks</span> <span class="o">=</span> <span class="n">wealth_index</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">drawdowns</span> <span class="o">=</span> <span class="p">(</span><span class="n">wealth_index</span> <span class="o">-</span> <span class="n">previous_peaks</span><span class="p">)</span> <span class="o">/</span> <span class="n">previous_peaks</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Max Drawdown&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">drawdowns</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_peaks</span><span class="p">[</span><span class="n">col</span><span class="p">][:</span><span class="n">drawdowns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">previous_peaks</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Trough&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">drawdowns</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">recovery_date</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">wealth_index</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_max</span> <span class="o">=</span> <span class="n">previous_peaks</span><span class="p">[</span><span class="n">col</span><span class="p">][:</span><span class="n">drawdowns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">recovery_wealth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">wealth_index</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">drawdowns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">():]])</span><span class="o">.</span><span class="n">T</span>
</span></span><span class="line"><span class="cl">        <span class="n">recovery_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recovery_wealth</span><span class="p">[</span><span class="n">recovery_wealth</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prev_max</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Recovery Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recovery_date</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Days to Recover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Recovery Date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Trough&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;MAR Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;CAGR&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="o">-</span><span class="n">df_stats</span><span class="p">[</span><span class="s1">&#39;Max Drawdown&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plan_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fund_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_stats</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Summary_Stats.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_stats</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">_Summary_Stats.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Summary stats complete for </span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df_stats</span>
</span></span></code></pre></div><h3 id="yf_pull_data" class="relative group">yf_pull_data <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#yf_pull_data" aria-label="Anchor">#</a></span></h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">yf_pull_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_directory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">asset_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">excel_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle_export</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_confirmation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Download daily price data from Yahoo Finance and export it.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters:
</span></span></span><span class="line"><span class="cl"><span class="s2">    -----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    base_directory
</span></span></span><span class="line"><span class="cl"><span class="s2">        Root path to store downloaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    ticker : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Ticker symbol to download.
</span></span></span><span class="line"><span class="cl"><span class="s2">    source : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Name of the data source (e.g., &#39;Yahoo&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    asset_class : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        Asset class name (e.g., &#39;Equities&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">    excel_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Excel format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    pickle_export : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, export data to Pickle format.
</span></span></span><span class="line"><span class="cl"><span class="s2">    output_confirmation : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        If True, print confirmation message.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">    --------
</span></span></span><span class="line"><span class="cl"><span class="s2">    df : pd.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        DataFrame containing the downloaded data.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Download data from YF</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&#34;1900-01-01&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Drop the column level with the ticker symbol</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Reset index</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove the &#34;Price&#34; header from the index</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Reset date column</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Set &#39;Date&#39; column as index</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Drop data from last day because it&#39;s not accrate until end of day</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create directory</span>
</span></span><span class="line"><span class="cl">    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_class</span><span class="si">}</span><span class="s2">/Daily&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to excel</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">excel_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export to pickle</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pickle_export</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">.pkl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output confirmation</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">output_confirmation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The first and last date of data for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> is: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Yahoo Finance data complete for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;--------------------&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span></code></pre></div><h2 id="references" class="relative group">References <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#references" aria-label="Anchor">#</a></span></h2><p>None</p>
<h2 id="code" class="relative group">Code <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#code" aria-label="Anchor">#</a></span></h2>The Jupyter notebook with the functions and all other code is available <a href="reusable-extensible-python-functions-financial-data-analysis.ipynb">here</a>.<br>
The HTML export of the jupyter notebook is available <a href="reusable-extensible-python-functions-financial-data-analysis.html">here</a>.<br>
The PDF export of the jupyter notebook is available <a href="reusable-extensible-python-functions-financial-data-analysis.pdf">here</a>.

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
      
      
        
        








  
    <picture
      class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"
      
    >
      
      
      
      
      <img
        width="1835"
        height="1835"
        class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"
        alt="Jared Szajkowski"
        loading="lazy" decoding="async"
        
          src="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/profile_pic_hu_807eb4aeeb8a909c.jpg" srcset="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/profile_pic_hu_12ef83e281637136.jpg 330w,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/profile_pic_hu_807eb4aeeb8a909c.jpg 660w
          
            ,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/profile_pic_hu_979fd5f15e5597f7.jpg 1024w
          
          
            ,https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/img/profile_pic_hu_6e4386d6b49b02c.jpg 1320w
          "
          sizes="100vw"
        
      />
    </picture>
  


      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Jared Szajkowski
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">An Engineer Studying Quant Finance</div>
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="mailto:jared.szajkowski@gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="https://github.com/jaredszajkowski"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a
        >
      
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="https://linkedin.com/in/jaredszajkowski"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a
        >
      
    
  </div>

</div>
    </div>
  </div>


      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="mailto:?body=https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/&amp;subject=Reusable%20And%20Extensible%20Python%20Functions%20For%20Financial%20Data%20Analysis"
          title="Send via email"
          aria-label="Send via email"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.facebook.com/sharer/sharer.php?u=https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/&amp;quote=Reusable%20And%20Extensible%20Python%20Functions%20For%20Financial%20Data%20Analysis"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://x.com/intent/tweet/?url=https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/&amp;text=Reusable%20And%20Extensible%20Python%20Functions%20For%20Financial%20Data%20Analysis"
          title="Post on X"
          aria-label="Post on X"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/&amp;title=Reusable%20And%20Extensible%20Python%20Functions%20For%20Financial%20Data%20Analysis"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.threads.net/intent/post?text=https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/%20Reusable%20And%20Extensible%20Python%20Functions%20For%20Financial%20Data%20Analysis"
          title="Post on Threads"
          aria-label="Post on Threads"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M331.5 235.7c2.2 .9 4.2 1.9 6.3 2.8c29.2 14.1 50.6 35.2 61.8 61.4c15.7 36.5 17.2 95.8-30.3 143.2c-36.2 36.2-80.3 52.5-142.6 53h-.3c-70.2-.5-124.1-24.1-160.4-70.2c-32.3-41-48.9-98.1-49.5-169.6V256v-.2C17 184.3 33.6 127.2 65.9 86.2C102.2 40.1 156.2 16.5 226.4 16h.3c70.3 .5 124.9 24 162.3 69.9c18.4 22.7 32 50 40.6 81.7l-40.4 10.8c-7.1-25.8-17.8-47.8-32.2-65.4c-29.2-35.8-73-54.2-130.5-54.6c-57 .5-100.1 18.8-128.2 54.4C72.1 146.1 58.5 194.3 58 256c.5 61.7 14.1 109.9 40.3 143.3c28 35.6 71.2 53.9 128.2 54.4c51.4-.4 85.4-12.6 113.7-40.9c32.3-32.2 31.7-71.8 21.4-95.9c-6.1-14.2-17.1-26-31.9-34.9c-3.7 26.9-11.8 48.3-24.7 64.8c-17.1 21.8-41.4 33.6-72.7 35.3c-23.6 1.3-46.3-4.4-63.9-16c-20.8-13.8-33-34.8-34.3-59.3c-2.5-48.3 35.7-83 95.2-86.4c21.1-1.2 40.9-.3 59.2 2.8c-2.4-14.8-7.3-26.6-14.6-35.2c-10-11.7-25.6-17.7-46.2-17.8H227c-16.6 0-39 4.6-53.3 26.3l-34.4-23.6c19.2-29.1 50.3-45.1 87.8-45.1h.8c62.6 .4 99.9 39.5 103.7 107.7l-.2 .2zm-156 68.8c1.3 25.1 28.4 36.8 54.6 35.3c25.6-1.4 54.6-11.4 59.5-73.2c-13.2-2.9-27.8-4.4-43.4-4.4c-4.8 0-9.6 .1-14.4 .4c-42.9 2.4-57.2 23.2-56.2 41.8l-.1 .1z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://bsky.app/intent/compose?text=https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/reusable-extensible-python-functions-financial-data-analysis/Reusable%20And%20Extensible%20Python%20Functions%20For%20Financial%20Data%20Analysis"
          title=""
          aria-label=""
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3zM288 227.1C261.9 176.4 190.9 81.9 124.9 35.3C61.6-9.4 37.5-1.7 21.6 5.5C3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7c3.3-.5 6.6-.9 10-1.4c-3.3 .5-6.6 1-10 1.4C74.3 308.6-9.1 342.8 100.3 464.5C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4c102.4-103.4 28.1-156-65.8-169.9c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3c64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z"/></svg>
</span></a
        >
      
    
  </section>


      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/arch-linux-install/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Arch Linux Install</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-09-29 00:00:01 &#43;0000 &#43;0000">September 29, 2023</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/posts/automating-execution-jupyter-notebook-files-python-scripts-hugo-static-site-generation/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Automating Execution of Jupyter Notebook Files, Python Scripts, and Hugo Static Site Generation</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-06-29 00:00:01 &#43;0000 &#43;0000">June 29, 2025</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
        
          <div class="pt-3">
            <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
            <div class="pt-3">
              

<script src="https://giscus.app/client.js"
        data-repo="jaredszajkowski/jaredszajkowski.github.io"
        data-repo-id="R_kgDOKZLn5w"
        data-category="Announcements"
        data-category-id="DIC_kwDOKZLn584CaJwO"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
            </div>
          </div>
        
      
    </footer>
  </article>

      </main>
      
        <div
          class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"
          id="to-top"
          hidden="true"
        >
          <a
            href="#the-top"
            class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      <footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            Copyright  2025 Jared Szajkowski. All rights reserved.
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://jaredszajkowski.github.io/jaredszajkowski.github.io_congo/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
